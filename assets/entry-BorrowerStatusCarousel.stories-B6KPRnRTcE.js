import{r as O,f as A,o as r,b as d,e as i,a as f,c as v,d as E,F as ce,N as Ie,J as R,z as Ae,h as c,j as w,w as Ee,A as Ve,S as De,G as $e,u as l,O as Oe,I as P,k as Pe,H as Z,K as Re}from"./entry-vue.esm-bundler-Bf_Yeyugwo.js";import{_ as Fe}from"./entry-throttle-DL1zg7kAk0.js";import{u as je}from"./entry-vue-router-DdFAIqQzgT.js";import"./entry-KvWwwHeader-CVdIzOPj6Q.js";import{U as de}from"./entry-KvButton-DF0Vhz1EWA.js";import{l as ze}from"./entry-KvCarousel--umaisw_ND.js";import"./entry-numeral-DJCTM12wUX.js";import{_ as Ke,H as Ue}from"./entry-KvTabs-Dt0rMR23wJ.js";import{I as He}from"./entry-KvTabPanel-Dqe0lxZDeq.js";import{a as qe,F as Ge,P as We,R as Ze,E as Ye,b as Je,c as Xe,B as Qe}from"./entry-BorrowerStatusCard-Cy8bp6EbbW.js";import{l as et}from"./entry-logFormatter-DhjghUk5Me.js";import{f as tt}from"./entry-mdi-BJHOrBfjV3.js";import{_ as ot}from"./entry-loanAddComment-DvQEPf3nxH.js";import{w as at}from"./entry-KvMaterialIcon-DcajXwg-0j.js";import{u as st}from"./entry-KvLightbox-Ccr5YlTKqp.js";import{_ as fe}from"./entry-_plugin-vue_export-helper-DlAUqK2UKH.js";import{S as nt}from"./entry-ShareButton-B3Ylkxw3-A.js";import{B as rt}from"./entry-BorrowerImage-WXGsRE2huI.js";import{m as lt}from"./entry-utils-LVhxYihmNs.js";import{a as it}from"./entry-apollo-story-mixin-CB9BNmK9U5.js";import{c as ut}from"./entry-cookie-store-story-mixin-Bv_t57ys9l.js";import"./entry-_commonjsHelpers-Cpj98o6Yn6.js";import"./entry-isSymbol-5pnFTpIKM9.js";import"./entry-toNumber-MeiYJWOH0A.js";import"./entry-KvLoadingSpinner-D0IZcQeh_0.js";import"./entry-throttle-DR-Bh3IiJx.js";import"./entry-HeroBackground-Cf59T6vSbl.js";import"./entry-KvContentfulImg-ClwkYYkTk_.js";import"./entry-KvSocialShareButton-7rHfWlFtkv.js";import"./entry-social-sharing-mixin-mcFPgMmQne.js";import"./entry-urlUtils-D59-4GikCB.js";import"./entry-imageUtils-_95xo2d0ng.js";import"./entry-loan-data-mock-B1RgYuoN0n.js";const pe={name:"LoanCommentModal",inject:["apollo","cookieStore"],components:{KvLightbox:st,KvMaterialIcon:at,KvButton:de},emits:["comment-modal-closed"],props:{loan:{type:Object,default:()=>({})},isVisible:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},data(){return{mdiPencilOutline:tt,userComment:"",loading:!1,showError:!1}},computed:{buttonState(){return this.loading?"loading":this.userComment?"":"disabled"},modalTitle(){return`Tell others why you love this loan to ${this.loan.name}`},commentPlaceholder(){return`Tell others why this loan to ${this.loan.name} is great!`}},watch:{isVisible(t){t&&this.$nextTick(()=>{var o;(o=this.$refs.commentTextarea)==null||o.focus()})}},methods:{submitComment(){this.loading=!0,this.showError=!1,this.apollo.mutate({mutation:ot,variables:{id:this.loan.id,body:this.userComment}}).then(({data:t})=>{if(t.loan.addComment)this.closeModal(!0),this.$kvTrackEvent("portfolio","click","Leave a loan comment",this.loan.name,this.loan.id),this.showTip&&this.$showTipMsg(`Thank you for helping ${this.loan.name}!`,"confirmation",!0);else throw new Error("Comment not added")}).catch(t=>{this.showError=!0,et(t,"error")}).finally(()=>{this.loading=!1})},closeModal(t=!1){this.userComment="",this.$emit("comment-modal-closed",t)}}},mt={class:"tw-text-center"},ct={class:"tw-relative"},dt=["placeholder"],ft={key:0,class:"tw-mt-1 tw-text-small tw-text-danger"};function pt(t,o,L,_,m,p){const g=O("kv-material-icon"),y=O("kv-button"),M=O("kv-lightbox");return r(),A(M,{visible:L.isVisible,title:p.modalTitle,onLightboxClosed:o[1]||(o[1]=()=>p.closeModal())},{default:d(()=>[i("div",mt,[i("div",ct,[ce(i("textarea",{ref:"commentTextarea",class:"tw-w-full tw-border tw-border-secondary tw-rounded-xs tw-h-7 tw-p-1 comment-input","onUpdate:modelValue":o[0]||(o[0]=k=>m.userComment=k),placeholder:p.commentPlaceholder},"			",8,dt),[[Ie,m.userComment]]),f(g,{class:"tw-w-2.5 tw-h-2.5 tw-absolute tw-bottom-2 tw-right-0",icon:m.mdiPencilOutline},null,8,["icon"])]),o[2]||(o[2]=i("small",{class:"tw-text-left tw-block"},[R("Please follow our "),i("a",{href:"/kiva-community-guidelines",target:"_blank",class:"tw-text-action hover:tw-text-action-highlight"}," community guidelines ")],-1))]),f(y,{class:"tw-mt-2",variant:"primary","aria-label":"Comment",state:p.buttonState,onClick:p.submitComment},{default:d(()=>o[3]||(o[3]=[R(" Save ")]),void 0,!0),_:1,__:[3]},8,["state","onClick"]),m.showError?(r(),v("p",ft," There was a problem commenting on this loan, try again please. ")):E("",!0)],void 0),_:1},8,["visible","title"])}const ht=fe(pe,[["render",pt],["__scopeId","data-v-3fc61cc0"]]);pe.__docgenInfo={displayName:"LoanCommentModal",exportName:"default",description:"",tags:{},props:[{name:"loan",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"isVisible",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"showTip",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}}],events:[{name:"comment-modal-closed",type:{names:["undefined"]}}],sourceFiles:["/home/runner/work/ui/ui/src/pages/Portfolio/ImpactDashboard/LoanCommentModal.vue"]};const wt=["innerHTML"],vt={key:1,class:"tw-relative"},bt={class:"tw-flex tw-flex-col tw-justify-start tw-items-center tw-w-10"},_t={class:"tw-w-8 tw-h-8 tw-mx-auto md:tw-mx-0 tw-border-white tw-border-4 tw-rounded-full tw-shadow"},gt={class:"tw-text-center tw-text-ellipsis tw-line-clamp-2 tw-whitespace-normal tw-pt-0.5"},yt=["id"],kt={class:"carousel-container"},xt={key:"view-more-card",class:"tw-flex tw-items-center tw-h-full tw-pl-4"},Ct="social_share_portfolio",he={__name:"BorrowerCarousel",props:{loans:{type:Array,default:()=>[],required:!0},totalLoans:{type:Number,default:0},showMenu:{type:Boolean,default:!1},lender:{type:Object,default:()=>({})},cardsNumber:{type:Number,default:9},showCarouselTabs:{type:Boolean,default:!1},basketItems:{type:Array,default:()=>[]},isAdding:{type:Boolean,default:!1}},emits:["handle-selected-loan","mouse-enter-status-card"],setup(t,{emit:o}){const L=o,_=t,m=Pe("$kvTrackEvent"),p=je(),{loans:g,totalLoans:y}=Ae(_),M=c(null),k=c(!1),x=c(0),F=c(!1),j=c(0),s=c(void 0),V=c(!1),D=c(null),ve=c(0),z=[qe,Ge,We,Ze,Ye,Je,Xe],be=w(()=>g.value.filter(e=>z.includes(e==null?void 0:e.status))),$=w(()=>be.value.length>0),_e=w(()=>y.value===1?"You’re <u>changing a life</u>!":`You’re <u>changing ${y.value} lives</u>!`),h=w(()=>g.value.filter(e=>z.includes(e==null?void 0:e.status)).slice(0,_.cardsNumber)),ge=w(()=>{var e;return((e=s.value)==null?void 0:e.inPfp)??!1}),ye=w(()=>{var e;return((e=s.value)==null?void 0:e.pfpMinLenders)??0}),ke=w(()=>{var e,a;return((a=(e=s.value)==null?void 0:e.lenders)==null?void 0:a.numLenders)??0}),K=()=>{ve.value=window.innerWidth},U=Fe(K,200),xe=e=>{j.value===x.value&&m("portfolio","click","borrower-card-carousel"),D.value.tabContext.selectedIndex=e.value},Ce=e=>{s.value=e==null?void 0:e.loan,s.value&&(k.value=!0)},Le=e=>{s.value=e==null?void 0:e.loan,s.value&&(V.value=!0)},H=()=>{setTimeout(()=>{s.value=void 0},500)},Me=()=>{V.value=!1,H()},q=e=>{var a;L("handle-selected-loan",{id:(a=e==null?void 0:e.loan)==null?void 0:a.id})},Se=e=>{k.value=!1,e&&q({loan:{id:s.value.id}}),H()},G=e=>(e==null?void 0:e.name)??"",Te=e=>{var a;return((a=e==null?void 0:e.image)==null?void 0:a.hash)??""},Ne=e=>{j.value=x.value,x.value!==e&&m("portfolio","click","borrower-tab-toggle"),e<h.value.length?(M.value.goToSlide(e),x.value=e):D.value.tabContext.selectedIndex=x.value},Be=()=>{m("portfolio","click","view-all"),p.push("/portfolio/loans")};return Ee(()=>g.value,()=>{$.value&&m("portfolio","view","Active borrowers",h.value.length)},{immediate:!0}),Ve(()=>{window.addEventListener("resize",U),K()}),De(()=>{window.removeEventListener("resize",U)}),(e,a)=>(r(),v("div",null,[$.value?(r(),v("h3",{key:0,innerHTML:_e.value,class:"tw-mt-4 tw-mb-2"},null,8,wt)):E("",!0),$.value?(r(),v("div",vt,[ce(f(l(Ue),{ref_key:"tabs",ref:D,class:"tabs",onTabChanged:Ne},{tabNav:d(()=>[(r(!0),v(Z,null,P(h.value,(n,b)=>(r(),A(l(Ke),{key:b,label:b+1,"for-panel":`${n.id}`},{default:d(()=>[i("div",bt,[i("div",_t,[f(l(rt),{class:"tw-w-full tw-rounded-full",alt:G(n),"aspect-ratio":1,"default-image":{width:80,faceZoom:50},hash:Te(n),images:[{width:80,faceZoom:50,viewSize:1024},{width:72,faceZoom:50,viewSize:734},{width:64,faceZoom:50}]},null,8,["alt","hash"])]),i("h5",gt,Re(G(n)),1)])],void 0,!0),_:2},1032,["label","for-panel"]))),128))]),tabPanels:d(()=>[(r(!0),v(Z,null,P(h.value,(n,b)=>(r(),A(l(He),{key:b,id:`${n.id}`},{default:d(()=>[i("p",{class:"tw-hidden",id:n.id},null,8,yt)],void 0,!0),_:2},1032,["id"]))),128))]),_:1},512),[[$e,h.value.length>1&&t.showCarouselTabs]]),i("div",kt,[f(l(ze),{ref_key:"carousel",ref:M,class:"borrower-carousel tw-w-full","multiple-slides-visible":!0,"slide-max-width":"336px","embla-options":{loop:!1,align:"center"},onChange:xe},Oe({_:2},[P(h.value,(n,b)=>({name:`slide${b+1}`,fn:d(()=>[f(l(Qe),{class:"tw-h-full",loan:n,"open-what-is-next":F.value,"show-menu":t.showMenu,onToggleWhatIsNext:a[0]||(a[0]=W=>F.value=W),onOpenCommentModal:Ce,onOpenShareModal:Le,onOpenSideSheet:q,onMouseenter:W=>e.$emit("mouse-enter-status-card",n==null?void 0:n.id)},null,8,["loan","open-what-is-next","show-menu","onMouseenter"])])})),l(y)>h.value.length?{name:"see-all",fn:d(()=>[(r(),v("div",xt,[f(l(de),{class:"tw-mt-2 tw-whitespace-nowrap",variant:"secondary",onClick:Be},{default:d(()=>a[1]||(a[1]=[R(" See all ")]),void 0,!0),_:1,__:[1]})]))]),key:"0"}:void 0]),1536)])])):E("",!0),f(l(ht),{loan:s.value,"is-visible":k.value,"show-tip":!1,onCommentModalClosed:Se},null,8,["loan","is-visible"]),s.value?(r(),A(l(nt),{key:2,class:"tw-block !tw-w-auto",variant:"hidden",loan:s.value,lender:t.lender,campaign:Ct,"in-pfp":ge.value,"pfp-min-lenders":ye.value,"num-lenders":ke.value,"open-lightbox":V.value,"is-portfolio":!0,onLightboxClosed:Me},null,8,["loan","lender","in-pfp","pfp-min-lenders","num-lenders","open-lightbox"])):E("",!0)]))}},we=fe(he,[["__scopeId","data-v-ae0ba5fc"]]);he.__docgenInfo={exportName:"default",displayName:"BorrowerCarousel",description:"",tags:{},props:[{name:"loans",description:"Array of loans",type:{name:"array"},required:!0,defaultValue:{func:!1,value:"[]"}},{name:"totalLoans",type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"showMenu",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"lender",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"cardsNumber",type:{name:"number"},defaultValue:{func:!1,value:"9"}},{name:"showCarouselTabs",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"basketItems",type:{name:"array"},defaultValue:{func:!1,value:"[]"}},{name:"isAdding",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"mouse-enter-status-card"},{name:"handle-selected-loan"}],sourceFiles:["/home/runner/work/ui/ui/src/components/MyKiva/BorrowerCarousel.vue"]};const no={title:"MyKiva/BorrowerCarousel",component:we},u=lt(3),Lt={data:{lend:{loan:u[0]}}},C=(t={})=>{const o=(L,{argTypes:_})=>({props:Object.keys(_),components:{BorrowerCarousel:we},mixins:[it({queryResult:Lt}),ut()],setup(){return{args:t}},template:`
            <borrower-carousel v-bind="args" />
        `});return o.args=t,o},S=C({loans:[u[0],u[1],u[2]]}),T=C({loans:[u[0]]}),N=C({loans:[...u,u[0]]}),B=C({loans:[u[0],u[1],u[2]],hasActiveLoans:!1}),I=C({loans:[]});var Y,J,X;S.parameters={...S.parameters,docs:{...(Y=S.parameters)==null?void 0:Y.docs,source:{originalSource:`story({
  loans: [mockLoans[0], mockLoans[1], mockLoans[2]]
})`,...(X=(J=S.parameters)==null?void 0:J.docs)==null?void 0:X.source}}};var Q,ee,te;T.parameters={...T.parameters,docs:{...(Q=T.parameters)==null?void 0:Q.docs,source:{originalSource:`story({
  loans: [mockLoans[0]]
})`,...(te=(ee=T.parameters)==null?void 0:ee.docs)==null?void 0:te.source}}};var oe,ae,se;N.parameters={...N.parameters,docs:{...(oe=N.parameters)==null?void 0:oe.docs,source:{originalSource:`story({
  loans: [...mockLoans, mockLoans[0]]
})`,...(se=(ae=N.parameters)==null?void 0:ae.docs)==null?void 0:se.source}}};var ne,re,le;B.parameters={...B.parameters,docs:{...(ne=B.parameters)==null?void 0:ne.docs,source:{originalSource:`story({
  loans: [mockLoans[0], mockLoans[1], mockLoans[2]],
  hasActiveLoans: false
})`,...(le=(re=B.parameters)==null?void 0:re.docs)==null?void 0:le.source}}};var ie,ue,me;I.parameters={...I.parameters,docs:{...(ie=I.parameters)==null?void 0:ie.docs,source:{originalSource:`story({
  loans: []
})`,...(me=(ue=I.parameters)==null?void 0:ue.docs)==null?void 0:me.source}}};const ro=["Default","OneLoan","MoreThanLimit","NoActiveLoans","Empty"];export{S as Default,I as Empty,N as MoreThanLimit,B as NoActiveLoans,T as OneLoan,ro as __namedExportsOrder,no as default};
