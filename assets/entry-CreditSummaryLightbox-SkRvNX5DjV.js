import{g as T,n as S}from"./entry-numeral-DJCTM12wUX.js";import{u as O}from"./entry-mdi-BJHOrBfjV3.js";import{c as i,o,F as B,a as W,f as d,b as D,J as L,r as g,e,K as m,H as p,I as K,d as k,P as N}from"./entry-vue.esm-bundler-Bf_Yeyugwo.js";import{_ as I}from"./entry-KvLoadingPlaceholder-DUZzoT9CoU.js";import"./entry-KvWwwHeader-CVdIzOPj6Q.js";import{u as F}from"./entry-KvLightbox-Ccr5YlTKqp.js";import{K as G}from"./entry-KvTextLink-CFK6VYUYhK.js";import{_ as R}from"./entry-_plugin-vue_export-helper-DlAUqK2UKH.js";import"./entry-_commonjsHelpers-Cpj98o6Yn6.js";import"./entry-KvMaterialIcon-DcajXwg-0j.js";const u=t=>S(t??0).value(),P={name:"CreditSummaryLightbox",inject:["apollo"],components:{KvLightbox:F,KvLoadingPlaceholder:I,KvTextLink:G},data(){return{loading:!0,loadingPromise:null,mdiFileDocumentOutline:O,showLightbox:!1,totalAmountDeposited:0,amountDepositedByKiva:0,kivaCardsRedeemedAmount:0,kivaCardsCanceledAmount:0,currencyGainsAmount:0,amountDonated:0,currencyLossesAmount:0,defaultLossesAmount:0,kivaCardsPurchasedAmount:0,amountWithdrawn:0,amountOutstanding:0,promoOutstanding:0,kivaCredit:0}},computed:{deposits(){return[{label:"Your deposits",value:this.totalAmountDeposited},{label:"Deposits by Kiva",value:this.amountDepositedByKiva,hideWhenZero:!0},{label:"Kiva Card redemptions",value:this.kivaCardsRedeemedAmount},{label:"Kiva Card cancellations",value:this.kivaCardsCanceledAmount},{label:"Currency loss reimbursements",value:this.currencyGainsAmount}]},deductions(){return[{label:"Donations to Kiva",value:this.amountDonated},{label:"Currency losses",value:this.currencyLossesAmount},{label:"Default losses",value:this.defaultLossesAmount},{label:"Kiva Card purchases",value:this.kivaCardsPurchasedAmount},{label:"Withdrawals",value:this.amountWithdrawn}]},depositSubTotal(){return this.deposits.reduce((t,{value:s})=>t+s,0)},deductionSubTotal(){return this.deductions.reduce((t,{value:s})=>t+s,0)},totalCreditInKiva(){return this.depositSubTotal+this.deductionSubTotal}},methods:{openLightbox(){this.showLightbox=!0,this.fetchAsyncData()},closeLightbox(){this.showLightbox=!1},formatCash(t){return S(t).format("$0,0.00")},fetchAsyncData(){this.loading&&!this.loadingPromise&&(this.loadingPromise=this.apollo.query({query:T`query creditSummary {
						my {
							id
							amountDonated
							amountWithdrawn
							amountDepositedByKiva
							currencyGainsAmount
							currencyLossesAmount
							defaultLossesAmount
							outstandingPromoCreditAmount
							kivaCardsCanceledAmount
							kivaCardsPurchasedAmount
							kivaCardsRedeemedAmount
							lendingStats {
								id
								totalAmountDeposited
							}
							userAccount {
								id
								balance
							}
							userStats {
								amount_outstanding
							}
						}
					}`}).then(({data:t})=>{var s,v,b,l,n,c,a,h,y,r,C,_,f,w,A,x;this.loading=!1,this.totalAmountDeposited=u((v=(s=t==null?void 0:t.my)==null?void 0:s.lendingStats)==null?void 0:v.totalAmountDeposited),this.amountDepositedByKiva=u((b=t==null?void 0:t.my)==null?void 0:b.amountDepositedByKiva),this.kivaCardsRedeemedAmount=u((l=t==null?void 0:t.my)==null?void 0:l.kivaCardsRedeemedAmount),this.kivaCardsCanceledAmount=u((n=t==null?void 0:t.my)==null?void 0:n.kivaCardsCanceledAmount),this.currencyGainsAmount=u((c=t==null?void 0:t.my)==null?void 0:c.currencyGainsAmount),this.amountDonated=u((a=t==null?void 0:t.my)==null?void 0:a.amountDonated),this.currencyLossesAmount=u((h=t==null?void 0:t.my)==null?void 0:h.currencyLossesAmount),this.defaultLossesAmount=u((y=t==null?void 0:t.my)==null?void 0:y.defaultLossesAmount)*-1,this.kivaCardsPurchasedAmount=u((r=t==null?void 0:t.my)==null?void 0:r.kivaCardsPurchasedAmount),this.amountWithdrawn=u((C=t==null?void 0:t.my)==null?void 0:C.amountWithdrawn),this.kivaCredit=u((f=(_=t==null?void 0:t.my)==null?void 0:_.userAccount)==null?void 0:f.balance),this.amountOutstanding=u((A=(w=t==null?void 0:t.my)==null?void 0:w.userStats)==null?void 0:A.amount_outstanding),this.promoOutstanding=u((x=t==null?void 0:t.my)==null?void 0:x.outstandingPromoCreditAmount)}).finally(()=>{this.loadingPromise=null}))}}},q={class:"tw-w-full tw-mb-4"},V={class:"tw-text-h3"},Z={class:"tw-p-1 tw-text-right tw-text-action"},j={key:1},E={key:0,class:"amount-table-row"},H={key:1},J={class:"tw-w-full tw-mb-4"},Y={class:"tw-text-h3"},z={class:"tw-p-1 tw-text-right tw-text-danger"},M={key:1},Q={key:0,class:"amount-table-row"},U={key:1},X={class:"tw-w-full"},$={class:"tw-text-h3"},tt={class:"tw-p-1 tw-text-right"},et={key:1},st={class:"amount-table-row"},ot={key:0},nt={key:1},lt={class:"amount-table-row"},it={key:1};function rt(t,s,v,b,l,n){const c=g("kv-text-link"),a=g("kv-loading-placeholder"),h=g("kv-lightbox"),y=N("kv-track-event");return o(),i("div",null,[B((o(),d(c,{icon:l.mdiFileDocumentOutline,onClick:n.openLightbox},{default:D(()=>s[0]||(s[0]=[L(" Details ")]),void 0),_:1,__:[0]},8,["icon","onClick"])),[[y,["portfolio","click","credit-stats-details"]]]),W(h,{visible:l.showLightbox,title:"Account balance sheet",onLightboxClosed:n.closeLightbox,"data-testid":"credit-summary",class:"credit-summary"},{default:D(()=>[s[12]||(s[12]=e("p",{class:"tw-text-small tw-text-secondary tw-mb-2"}," Please note, summary data may be up to one hour old. ",-1)),e("table",q,[s[2]||(s[2]=e("caption",{class:"tw-sr-only"}," Deposits ",-1)),s[3]||(s[3]=e("thead",{class:"tw-sr-only"},[e("tr",null,[e("th",null,"Deposit type"),e("th",null,"Amount")])],-1)),e("tbody",null,[e("tr",V,[s[1]||(s[1]=e("td",{class:"tw-py-1"}," Total deposits ",-1)),e("td",Z,[l.loading?(o(),d(a,{key:0,class:"header-amount-placeholder"})):(o(),i("span",j,m(n.formatCash(n.depositSubTotal)),1))])]),(o(!0),i(p,null,K(n.deposits,r=>(o(),i(p,{key:r.label},[!r.hideWhenZero||r.value!==0?(o(),i("tr",E,[e("td",null,m(r.label),1),e("td",null,[l.loading?(o(),d(a,{key:0,class:"amount-placeholder"})):(o(),i("span",H,m(n.formatCash(r.value)),1))])])):k("",!0)],64))),128))])]),e("table",J,[s[5]||(s[5]=e("caption",{class:"tw-sr-only"}," Deductions ",-1)),s[6]||(s[6]=e("thead",{class:"tw-sr-only"},[e("tr",null,[e("th",null,"Deduction type"),e("th",null,"Amount")])],-1)),e("tbody",null,[e("tr",Y,[s[4]||(s[4]=e("td",{class:"tw-py-1"}," Total deductions ",-1)),e("td",z,[l.loading?(o(),d(a,{key:0,class:"header-amount-placeholder"})):(o(),i("span",M,m(n.formatCash(n.deductionSubTotal)),1))])]),(o(!0),i(p,null,K(n.deductions,r=>(o(),i(p,{key:r.label},[!r.hideWhenZero||r.value!==0?(o(),i("tr",Q,[e("td",null,m(r.label),1),e("td",null,[l.loading?(o(),d(a,{key:0,class:"amount-placeholder"})):(o(),i("span",U,m(n.formatCash(r.value)),1))])])):k("",!0)],64))),128))])]),e("table",X,[s[10]||(s[10]=e("caption",{class:"tw-sr-only"}," Current credits ",-1)),s[11]||(s[11]=e("thead",{class:"tw-sr-only"},[e("tr",null,[e("th",null,"Credit type"),e("th",null,"Amount")])],-1)),e("tbody",null,[e("tr",$,[s[7]||(s[7]=e("td",{class:"tw-py-1"}," Total credit in Kiva ",-1)),e("td",tt,[l.loading?(o(),d(a,{key:0,class:"header-amount-placeholder"})):(o(),i("span",et,m(n.formatCash(n.totalCreditInKiva)),1))])]),e("tr",st,[e("td",null,[s[8]||(s[8]=L(" Outstanding balance ")),l.promoOutstanding>0?(o(),i("span",ot," (minus "+m(n.formatCash(l.promoOutstanding))+" promo credit balance) ",1)):k("",!0)]),e("td",null,[l.loading?(o(),d(a,{key:0,class:"amount-placeholder"})):(o(),i("span",nt,m(n.formatCash(l.amountOutstanding)),1))])]),e("tr",lt,[s[9]||(s[9]=e("td",null,"Kiva credit",-1)),e("td",null,[l.loading?(o(),d(a,{key:0,class:"amount-placeholder"})):(o(),i("span",it,m(n.formatCash(l.kivaCredit)),1))])])])])],void 0),_:1,__:[12]},8,["visible","onLightboxClosed"])])}const gt=R(P,[["render",rt],["__scopeId","data-v-fec0862e"]]);P.__docgenInfo={displayName:"CreditSummaryLightbox",exportName:"default",description:"",tags:{},sourceFiles:["/home/runner/work/ui/ui/src/pages/Portfolio/ImpactDashboard/CreditSummaryLightbox.vue"]};export{gt as default};
