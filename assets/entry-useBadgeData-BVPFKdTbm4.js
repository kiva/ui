import{h as F,j as y}from"./entry-vue.esm-bundler-Bf_Yeyugwo.js";import{l as B}from"./entry-logReadQueryError-Codcl0QZ_g.js";import{d as G}from"./entry-achievementUtils-Cf0LlmQMSn.js";const M=`query UserAchievementProgress($publicId: String) {
  userAchievementProgress(publicId: $publicId) {
    id
    lendingAchievements {
      id
      description
      milestoneProgress {
        earnedAtDate
        id
        milestoneStatus
        progress
        target
      }
    }
    tieredLendingAchievements {
      id
	  description
      totalProgressToAchievement
	  loanPurchases (limit: 3) {
        loan {
          id
		  name
          image {
			id
            hash
			url
          }
        }
      }
      tiers {
        target
        tierStatement
        completedDate
        learnMoreURL
      }
    }
  }
}
`,x={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserAchievementProgress"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"publicId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAchievementProgress"},arguments:[{kind:"Argument",name:{kind:"Name",value:"publicId"},value:{kind:"Variable",name:{kind:"Name",value:"publicId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lendingAchievements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"milestoneProgress"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"earnedAtDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"milestoneStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"progress"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"target"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"tieredLendingAchievements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProgressToAchievement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"loanPurchases"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"IntValue",value:"3"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"loan"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hash"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"tiers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"target"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tierStatement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"completedDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"learnMoreURL"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:674,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:M}}},Q=`# The preview parameter should come from a route query param and
# should not be passed in manually. It is handled by src/api/ContentfulPreviewLink.js
query contentfulEntries(
	$contentType: String!
	$contentKey: String
	$preview: Boolean
	$limit: Int
) {
	contentful {
		entries(
			contentType: $contentType
			contentKey: $contentKey
			preview: $preview
			limit: $limit
		)
	}
}
`,Y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"contentfulEntries"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contentType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contentKey"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"preview"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentful"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[{kind:"Argument",name:{kind:"Name",value:"contentType"},value:{kind:"Variable",name:{kind:"Name",value:"contentType"}}},{kind:"Argument",name:{kind:"Name",value:"contentKey"},value:{kind:"Variable",name:{kind:"Name",value:"contentKey"}}},{kind:"Argument",name:{kind:"Name",value:"preview"},value:{kind:"Variable",name:{kind:"Name",value:"preview"}}},{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}}],directives:[]}]}}]}}],loc:{start:0,end:422,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Q}}},w="equity",J="wrd-2024-challenge",H="wrd-23-challenge",j="earthday-23-challenge",W="earth-day-2024-challenge",K="iwd-challenge",z="iwd-2024-challenge",X="climate-challenge",Z="2BB-23-Roadto3BB",b="2BB-23-Thanks",p="womens-equality",k="us-economic-equality",g="climate-action",f="refugee-equality",h="basic-needs",he="support-all",ee={[p]:{gender:["female"]},[k]:{country:["PR","US"]},[g]:{tag:["8","9"]},[f]:{attribute:["28"]},[h]:{sector:["6","10","20","21"]}},ne={[p]:"women",[k]:"kiva-u-s",[g]:"eco-friendly",[f]:"refugees-and-i-d-ps",[h]:"basic-needs"},Ne={[p]:"woman",[k]:"entrepreneur",[g]:"person",[f]:"refugee",[h]:"person"},ie=["PR","US"],te="female",ae="refugees/displaced",se=[6,10,20,21],re="water and sanitation",le="clean energy",oe=["#eco-friendly","#sustainable ag"];function Se(){const S=F(),D=F(),A=e=>{var i,n,t,a,r,l,o,c,s,m,v,d,u;return{id:((n=(i=e==null?void 0:e.fields)==null?void 0:i.key)==null?void 0:n.replace(/-level-\d+/,""))??"",level:+(((a=(t=e==null?void 0:e.fields)==null?void 0:t.key)==null?void 0:a.replace(/\D/g,""))??""),levelName:((r=e==null?void 0:e.fields)==null?void 0:r.levelName)??"",challengeName:((l=e==null?void 0:e.fields)==null?void 0:l.challengeName)??"",imageUrl:((m=(s=(c=(o=e==null?void 0:e.fields)==null?void 0:o.badgeImage)==null?void 0:c.fields)==null?void 0:s.file)==null?void 0:m.url)??"",shareFact:((v=e==null?void 0:e.fields)==null?void 0:v.shareFact)??"",shareFactFootnote:((d=e==null?void 0:e.fields)==null?void 0:d.shareFactFootnote)??"",shareFactUrl:((u=e==null?void 0:e.fields)==null?void 0:u.shareFactUrl)??""}},L=(e,i=null)=>{e.query({query:x,variables:{publicId:i}}).then(n=>{var t,a,r,l;S.value=[...((a=(t=n.data)==null?void 0:t.userAchievementProgress)==null?void 0:a.lendingAchievements)??[],...((l=(r=n.data)==null?void 0:r.userAchievementProgress)==null?void 0:l.tieredLendingAchievements)??[]]}).catch(n=>{B(n,"useBadgeData userAchievementProgressQuery")})},C=e=>{e.query({query:Y,variables:{contentType:"challenge",limit:200}}).then(i=>{var n,t,a;D.value=(((a=(t=(n=i.data)==null?void 0:n.contentful)==null?void 0:t.entries)==null?void 0:a.items)??[]).map(r=>A(r))}).catch(i=>{B(i,"useBadgeData contentfulEntriesQuery")})},E=(e,i)=>{const n=[];return(e==null?void 0:e.length)>0&&(i==null?void 0:i.length)>0&&e.forEach(t=>{var r;const a=i.filter(l=>l.id===t.id);if(t&&a.length>0){const l=[...t.tiers??[]].map((d,u)=>{const I=JSON.parse(JSON.stringify(d));return I.level=u+1,I});l.sort((d,u)=>d.target-u.target),a.sort((d,u)=>d.level-u.level);const o=l.filter(d=>!!d.completedDate),c=o.length>0||(t==null?void 0:t.totalProgressToAchievement)>0,s=c?(r=o==null?void 0:o[o.length-1])==null?void 0:r.level:void 0,{milestoneProgress:m}=t,v=m==null?void 0:m.map(d=>{var u;return{...d,earnedAtDate:(u=d.earnedAtDate)==null?void 0:u.replace("[UTC]","")}});n.push({id:t.id,challengeName:a[0].challengeName,description:t.description,contentfulData:a,achievementData:{...t,tiers:l.map(d=>{var u;return{...d,completedDate:(u=d.completedDate)==null?void 0:u.replace("[UTC]","")}}),milestoneProgress:v},hasStarted:c,level:s})}}),n},O=e=>{const i=(e.level===e.achievementData.tiers.length?e.level-1:e.level)??0,n=e.achievementData.tiers[i];return{...e.contentfulData.find(t=>t.level===(n==null?void 0:n.level)),...n}},_=y(()=>E(S.value,D.value)),N=e=>{const i=e!=null&&e.levelName?` (level ${e==null?void 0:e.levelName})`:"",n=(e==null?void 0:e.challengeName)??"";return i?`${n}${i}`:n},P=(e,i)=>{var r,l,o,c,s,m;const n=(l=(r=e==null?void 0:e.achievementData)==null?void 0:r.tiers)==null?void 0:l.findIndex(v=>(v==null?void 0:v.level)===i),t=(c=(o=e==null?void 0:e.achievementData)==null?void 0:o.tiers)==null?void 0:c[n],a=((s=e==null?void 0:e.contentfulData)==null?void 0:s[n])||(typeof((m=e==null?void 0:e.contentfulData)==null?void 0:m.length)>"u"?e.contentfulData:void 0);return{...e,contentfulData:a,achievementData:t,tierName:N(a)||e.challengeName}},U=(e,i)=>{const n="/lend/filter",t=ne[e]||"",a=t?`/lend-by-category/${t}`:n,r=i==null?void 0:i.path;if(r!==a){if(r===n){const l=JSON.parse(JSON.stringify((i==null?void 0:i.query)??{})),o=ee[e];return Object.keys(o).forEach(c=>{l[c]=o[c]}),`${n}?${new URLSearchParams(l).toString()}`}return a}},$=e=>e.includes("badge_")&&e.includes("social_share")&&G.some(i=>e.includes(i)),q=e=>{var i,n,t,a,r,l,o,c;if((n=(i=e==null?void 0:e.achievementData)==null?void 0:i.milestoneProgress)!=null&&n.length){if((r=(a=(t=e.achievementData)==null?void 0:t.milestoneProgress)==null?void 0:a[0])==null?void 0:r.earnedAtDate){const m=((l=e.contentfulData)==null?void 0:l[0])??{};return{...e,contentfulData:m,levelName:N(m)}}}else if((c=(o=e==null?void 0:e.achievementData)==null?void 0:o.tiers)!=null&&c.length){const s=JSON.parse(JSON.stringify(e.achievementData.tiers));s.sort((d,u)=>d.completedDate===u.completedDate?u.level-d.level:new Date(u.completedDate)-new Date(d.completedDate));const m=s[0].level-1,v=e.contentfulData[m];return{...e,contentfulData:v,achievementData:s[0],levelName:N(v)}}return{}},R=e=>{const i=[w,p,k,h,g,f];let n;if(e!=null&&e.length){const t=JSON.parse(JSON.stringify(e));t.sort((a,r)=>i.indexOf(a.id)-i.indexOf(r.id));for(let a=0;a<t.length;a+=1){const r=t[a];(!n||(r.level??1)>n.level)&&(n=r)}}return n??{}},T=e=>{const i=[];return e==null||e.forEach(n=>{var t,a,r,l,o,c,s;if((a=(t=n==null?void 0:n.achievementData)==null?void 0:t.tiers)!=null&&a.length){const{tiers:m}=n.achievementData;m.forEach(v=>{v.completedDate&&i.push({...n,earnedAtDate:v.completedDate,level:v.level})})}if((l=(r=n==null?void 0:n.achievementData)==null?void 0:r.milestoneProgress)!=null&&l.length){const m=(s=(c=(o=n.achievementData)==null?void 0:o.milestoneProgress)==null?void 0:c[0])==null?void 0:s.earnedAtDate;m&&i.push({...n,earnedAtDate:m,level:0})}}),i},V=y(()=>{const e=T(_.value);return e.sort((i,n)=>new Date(i.earnedAtDate)-new Date(n.earnedAtDate)),e});return{badgeAchievementData:S,badgeContentfulData:D,badgeData:_,combineBadgeData:E,completedBadges:V,fetchAchievementData:L,fetchContentfulData:C,getActiveTierData:O,getCompletedBadges:T,getContentfulLevelData:A,getEarnedBadgeExplanation:(e,i)=>{switch(e){case p:return`for helping ${i} women`;case g:return`for helping ${i} climate stewards with eco-friendly projects`;case k:return`for helping ${i} people in the United States or Puerto Rico`;case h:return`for helping ${i} people in need of housing, healthcare, clean water or sanitation`;case f:return`for helping ${i} refugees or displaced people`;case w:return"for helping your first person on kiva";case H:case J:return"for helping a refugee on world refugee day";case j:case W:return"for contributing to a climate project on earth day";case K:case z:return"for helping a woman on international women’s day";case X:return"for contributing to 3 eco-friendly projects";case Z:return"for helping us kickstart our goal to reach $3b in total impact";case b:return"for helping us reach $2b in total impact";default:return""}},getHighestPriorityDisplayBadge:R,getLastCompletedBadgeLevelData:q,getLevelName:N,getLoanFindingUrl:U,getTierBadgeDataByLevel:P,getTierBadgeHeadline:e=>{switch(e){case p:return"lending to women";case g:return"supporting climate solutions";case k:return"lending to U.S entrepreneurs";case h:return"supporting basic needs";case f:return"lending to refugees";default:return"lending"}},ID_BASIC_NEEDS:h,ID_CLIMATE_ACTION:g,ID_REFUGEE_EQUALITY:f,ID_US_ECONOMIC_EQUALITY:k,ID_WOMENS_EQUALITY:p,isBadgeKeyValid:$,getLevelCaption:e=>{switch(e.level){case 1:return"One";case 2:return"Two";case 3:return"Three";case 4:return"Four";case 5:return"Five";case 6:return"Six";case 7:return"Seven";case 8:return"Eight";case 9:return"Nine";case 10:return"Ten";default:return e.level}},getJourneysByLoan:e=>{var n,t,a,r,l,o,c;const i=[];return ie.includes((t=(n=e==null?void 0:e.geocode)==null?void 0:n.country)==null?void 0:t.isoCode)&&i.push(k),(e==null?void 0:e.gender)===te&&i.push(p),(a=e==null?void 0:e.themes)!=null&&a.some(s=>(s==null?void 0:s.toLowerCase())===ae)&&i.push(f),(se.includes((r=e==null?void 0:e.sector)==null?void 0:r.id)||(l=e==null?void 0:e.themes)!=null&&l.some(s=>(s==null?void 0:s.toLowerCase())===re))&&i.push(h),((o=e==null?void 0:e.tags)!=null&&o.some(s=>oe.includes(s==null?void 0:s.toLowerCase()))||(c=e==null?void 0:e.themes)!=null&&c.some(s=>(s==null?void 0:s.toLowerCase())===le))&&i.push(g),i},getAllCategoryLoanCounts:e=>(e==null?void 0:e.reduce((i,n)=>(i[n.id]=n.totalProgressToAchievement??0,i),{}))??{[p]:0,[k]:0,[h]:0,[g]:0,[f]:0},allAchievementsCompleted:e=>e!=null&&e.length?e.filter(n=>{var t;return(t=n==null?void 0:n.tiers)==null?void 0:t.length}).every(n=>{const t=n==null?void 0:n.tiers;return t!=null&&t.length?t.every(a=>!!a.completedDate):!1}):!1}}export{Ne as C,h as I,w as a,f as b,g as c,k as d,p as e,he as f,Se as u};
