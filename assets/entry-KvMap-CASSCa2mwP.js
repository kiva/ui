import{c as r}from"./entry-observerUtils-DveHpw6JZJ.js";import{c as m,e as h,x as d,o as p}from"./entry-vue.esm-bundler-Bf_Yeyugwo.js";import{_ as u}from"./entry-_plugin-vue_export-helper-DlAUqK2UKH.js";function o(e,t=3e3){return new Promise((a,i)=>{typeof window>"u"&&i({error:"window object not available"});let l;const s=window.setInterval(()=>{typeof window[e]<"u"&&(clearInterval(s),clearTimeout(l),a({loaded:!0}))},100);l=window.setTimeout(()=>{clearInterval(s),clearTimeout(l),a({loaded:!1})},t)})}const n={name:"KvMap",head(){return{script:[].concat(this.hasWebGL?[]:[{vmid:`leafletjs${this.mapId}`,src:"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js",async:!0,defer:!0}]).concat(this.hasWebGL?[{vmid:`maplibregljs${this.mapId}`,src:"https://cdn.maptiler.com/maplibre-gl-js/v1.14.0/maplibre-gl.js",async:!0,defer:!0}]:[]),link:[].concat(this.hasWebGL?[]:[{vmid:`leafletcss${this.mapId}`,rel:"stylesheet",href:"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"}]).concat(this.hasWebGL?[{vmid:`maplibreglcss${this.mapId}`,rel:"stylesheet",href:"https://cdn.maptiler.com/maplibre-gl-js/v1.14.0/maplibre-gl.css"}]:[])}},props:{aspectRatio:{type:Number,default:1},autoZoomDelay:{type:Number,default:1500},height:{type:Number,default:null},initialZoom:{type:Number,default:null},lat:{type:Number,default:null},long:{type:Number,default:null},mapId:{type:Number,default:0},useLeaflet:{type:Boolean,default:!1},width:{type:Number,default:null},zoomLevel:{type:Number,default:4}},data(){return{hasWebGL:!1,leafletReady:!1,mapInstance:null,mapLibreReady:!1,mapLoaded:!1,zoomActive:!1}},computed:{mapDimensions(){var i;const e=(i=this.$el)==null?void 0:i.getBoundingClientRect(),t=e?`${e.width/this.aspectRatio}px`:"300px",a=e?`${e.width}px`:"100%";return{height:this.height?`${this.height}px`:t,width:this.width?`${this.width}px`:a,paddingBottom:this.height?`${this.height}px`:`${100/this.aspectRatio}%`}},refString(){return`mapholder${this.mapId}`}},watch:{lat(e,t){t===null&&this.long&&!this.mapLibreReady&&!this.leafletReady&&this.initializeMap()},long(e,t){t===null&&this.lat&&!this.mapLibreReady&&!this.leafletReady&&this.initializeMap()}},mounted(){!this.mapLibreReady&&!this.leafletReady&&this.initializeMap()},methods:{activateZoom(e=!1){const{mapInstance:t,hasWebGL:a,mapLibreReady:i}=this,l=t.getZoom();if(!e&&l===this.zoomLevel||e&&l===this.initialZoom)return!1;this.zoomActive=!0;const s=window.setTimeout(()=>{a&&i?t.zoomTo(e?this.initialZoom:this.zoomLevel,{duration:1200}):t.setZoom(e?this.initialZoom:this.zoomLevel),clearTimeout(s),this.zoomActive=!1},this.autoZoomDelay)},createWrapperObserver(){var e;this.wrapperObserver=r({targets:[(e=this.$refs)==null?void 0:e[this.refString]],callback:t=>{t.forEach(a=>{var i;a.target===((i=this.$refs)==null?void 0:i[this.refString])&&!this.zoomActive&&a.intersectionRatio>0&&this.activateZoom()})}})},destroyWrapperObserver(){this.wrapperObserver&&this.wrapperObserver.disconnect()},checkWebGL(){if(this.useLeaflet||typeof document>"u")return!1;const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return t&&t instanceof WebGLRenderingContext?(this.hasWebGL=!0,!0):!1},initializeMap(){this.checkWebGL()?o("maplibregl").then(e=>{e.loaded&&!this.mapLoaded&&!this.useLeaflet&&this.lat&&this.long&&(this.initializeMapLibre(),this.mapLibreReady=!0)}):o("L").then(e=>{e.loaded&&!this.mapLoaded&&this.lat&&this.long&&(this.initializeLeaflet(),this.leafletReady=!0)})},initializeLeaflet(){this.mapInstance=L.map(`kv-map-holder-${this.mapId}`,{center:[this.lat,this.long],zoom:this.initialZoom||this.zoomLevel,dragging:!1,zoomControl:!1,animate:!0,scrollWheelZoom:!1,doubleClickZoom:!1,attributionControl:!1}),L.tileLayer("https://api.maptiler.com/maps/bright/{z}/{x}/{y}.png?key=n1Mz5ziX3k6JfdjFe7mx",{tileSize:512,zoomOffset:-1,minZoom:1,crossOrigin:!0}).addTo(this.mapInstance),this.mapLoaded=!0,this.initialZoom!==null&&this.createWrapperObserver()},initializeMapLibre(){this.mapInstance=new maplibregl.Map({container:`kv-map-holder-${this.mapId}`,style:"https://api.maptiler.com/maps/bright/style.json?key=n1Mz5ziX3k6JfdjFe7mx",center:[this.long,this.lat],zoom:this.initialZoom||this.zoomLevel,attributionControl:!1,dragPan:!1,scrollZoom:!1,doubleClickZoom:!1,dragRotate:!1}),this.mapLoaded=!0,this.initialZoom!==null&&this.createWrapperObserver()}},beforeUnmount(){this.mapInstance&&(!this.hasWebGL&&!this.leafletReady&&this.mapInstance.off(),this.mapInstance.remove()),this.destroyWrapperObserver()}},c=["id"];function f(e,t,a,i,l,s){return p(),m("div",{class:"tw-relative tw-block tw-w-full",style:d(s.mapDimensions)},[h("div",{id:`kv-map-holder-${a.mapId}`,ref:s.refString,class:"tw-w-full tw-h-full tw-bg-black",style:{position:"absolute"}},null,8,c)],4)}const y=u(n,[["render",f]]);n.__docgenInfo={displayName:"KvMap",exportName:"default",description:"",tags:{},props:[{name:"aspectRatio",description:`Aspect Ration for computed map dimensions
We'll divide the container width by this to determine the height`,type:{name:"number"},defaultValue:{func:!1,value:"1"}},{name:"autoZoomDelay",description:"Control how quickly the autoZoom occurs",type:{name:"number"},defaultValue:{func:!1,value:"1500"}},{name:"height",description:"Set the height to override aspect ratio driven and/or default dimensions",type:{name:"number"},defaultValue:{func:!1,value:"null"}},{name:"initialZoom",description:"Setting this initialZoom will zoom the map from initialZoom to zoom when the map enters the viewport",type:{name:"number"},defaultValue:{func:!1,value:"null"}},{name:"lat",description:"Set the center point latitude",type:{name:"number"},defaultValue:{func:!1,value:"null"}},{name:"long",description:"Set the center point longitude",type:{name:"number"},defaultValue:{func:!1,value:"null"}},{name:"mapId",description:"Set this if there are more than one map on the page",type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"useLeaflet",description:"Force use of Leaflet",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"width",description:"Set the width to override aspect ratio driven and/or default dimensions",type:{name:"number"},defaultValue:{func:!1,value:"null"}},{name:"zoomLevel",description:"Default zoom level",type:{name:"number"},defaultValue:{func:!1,value:"4"}}],sourceFiles:["/home/runner/work/ui/ui/src/components/Kv/KvMap.vue"]};export{y as K};
