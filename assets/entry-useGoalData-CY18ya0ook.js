import{j as L,g as Y,b as ee}from"./entry-vue.esm-bundler-C0PPCo9W96.js";import{l as h}from"./entry-logFormatter-DhjghUk5Me.js";import{g as ye}from"./entry-myKivaUtils-DUwPoPrS-N.js";import{g as ae}from"./entry-index-CWclSTHHJk.js";import{l as ne}from"./entry-logReadQueryError-Codcl0QZ_g.js";import{d as A,f as v,b as M,I as G,c as O,a as R,u as Se,h as he,i as we,g as Pe}from"./entry-useBadgeData-Bo50EdUMyn.js";const Ne=`query useGoalDataQuery {
  my {
    id
	userPreferences {
      id
      preferences
    }
	loans {
	  totalCount
	}
  }
}
`,Te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"useGoalDataQuery"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"my"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userPreferences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"preferences"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"loans"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalCount"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:161,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Ne}}},Ie=`query useGoalDataProgressQuery($loanIds: [Int!]!, $year: Int) {
  postCheckoutAchievements(loanIds: $loanIds, year: $year) {
	allTimeProgress {
		achievementId
        totalProgress
        currentTier
        completed
	}
	yearlyProgress {
		achievementId
        totalProgress
        currentTier
        completed
	}
	overallProgress {
		id
		achievementId
		contributingLoanIds
	}
  }
}
`,Ce={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"useGoalDataProgressQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loanIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"year"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"postCheckoutAchievements"},arguments:[{kind:"Argument",name:{kind:"Name",value:"loanIds"},value:{kind:"Variable",name:{kind:"Name",value:"loanIds"}}},{kind:"Argument",name:{kind:"Name",value:"year"},value:{kind:"Variable",name:{kind:"Name",value:"year"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"allTimeProgress"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"achievementId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProgress"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currentTier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"completed"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"yearlyProgress"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"achievementId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProgress"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currentTier"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"completed"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"overallProgress"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"achievementId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contributingLoanIds"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:429,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Ie}}},Fe=`query useGoalDataYearlyProgressQuery($year: Int) {
    userAchievementProgress(year: $year) {
        id
        tieredLendingAchievements {
            id
            progressForYear
            totalProgressToAchievement
        }
    }
}
`,De={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"useGoalDataYearlyProgressQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"year"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAchievementProgress"},arguments:[{kind:"Argument",name:{kind:"Name",value:"year"},value:{kind:"Variable",name:{kind:"Name",value:"year"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tieredLendingAchievements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"progressForYear"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProgressToAchievement"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:279,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Fe}}},Ae=`query loanStatsByYear($year: Int!) {
  my {
    id
    lendingStats {
      id
      loanStatsByYear(year: $year) {
        amount
        count
      }
    }
  }
}
`,be={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"loanStatsByYear"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"year"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"my"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lendingStats"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"loanStatsByYear"},arguments:[{kind:"Argument",name:{kind:"Name",value:"year"},value:{kind:"Variable",name:{kind:"Name",value:"year"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:203,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Ae}}},Ee=ae`
	mutation createUserPreferences($preferences: String) {
		my {
			createUserPreferences(userPreferences: { preferences: $preferences }) {
				id
				preferences
			}
		}
	}
`,Ye=ae`
	mutation UpdateUserPreferences(
		$updateUserPreferencesId: Int!,
		$preferences: String
	) {
		my {
			updateUserPreferences(id: $updateUserPreferencesId, userPreferences: {
				preferences: $preferences
		}) {
				id
				preferences
			}
		}
	}
`,_e=async(y,u)=>{try{return await y.mutate({mutation:Ee,variables:{preferences:JSON.stringify(u)}})}catch(T){ne(T,"userPreferenceUtils createUserPreferencesMutation")}},_=async(y,u,T,f)=>{try{const S={...T,...f},I=JSON.stringify(S);return await y.mutate({mutation:Ye,variables:{updateUserPreferencesId:u.id,preferences:I}})}catch(S){ne(S,"userPreferenceUtils updateUserPreferencesMutation")}},Me=""+new URL("women-cSREyC1a.svg",import.meta.url).href,Ge=""+new URL("refugees-gooArrEK.svg",import.meta.url).href,Oe=""+new URL("climate-action-CgDtPaVq.svg",import.meta.url).href,Re="data:image/svg+xml,%3csvg%20width='56'%20height='48'%20viewBox='0%200%2056%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.37205%2023.5141L8.63355%2028.5703L11.3286%2030.7585L17.0526%2030.9255L19.9146%2032.9169L22.3175%2032.5055L25.0961%2037.0013L26.4853%2036.4587L27.9938%2035.302L30.0211%2032.3684L32.424%2033.4595L34.5705%2031.6887L37.0807%2031.9331L39.269%2032.267H39.6029L42.0415%2036.7151L43.3056%2036.3037L44.8201%2032.0941L42.9061%2029.1069L42.3993%2027.0618L43.2877%2026.0958L45.4342%2022.9595L43.7885%2020.7773C43.7885%2020.7773%2044.5458%2019.9604%2044.671%2019.549C44.7962%2019.1376%2045.0526%2017.0984%2045.0526%2017.0984L47.4555%2015.3275L47.3303%2012.3284C47.3303%2012.3284%2049.5305%2010.4442%2049.5305%2010.0388C49.5305%209.63332%2047.3422%207.17676%2047.3422%207.17676L46.6684%209.0311L43.9734%2011.7262L43.1565%2013.9681L41.1591%2014.2662L40.4436%2014.2483L39.263%2012.5669L38.2553%2012.3999L36.3354%2013.4255C36.3354%2013.4255%2035.4529%2013.8369%2035.3218%2014.2423C35.2323%2014.5226%2034.815%2016.5141%2034.5705%2017.7185C34.5228%2017.951%2035.5424%2015.6078%2035.4768%2015.3752L34.2127%2013.2466L35.7272%2010.3846L33.3005%2011.3863L32.1915%2011.5652L31.1719%2010.9153L31.1838%209.54388L29.6693%208.3633L25.1259%209.20401C25.1259%209.20401%2014.8584%208.87011%2015.5322%208.87011C15.9436%208.87011%2010.9828%208.23809%2010.9828%208.23809L7.57222%208.10095L8.07903%209.59754L5.80135%209.05495L5.29454%2010.2832L5.92656%2011.2372L4.86523%2014.1112L5.37205%2023.5141Z'%20fill='%23E0988D'/%3e%3cpath%20d='M7.22675%2022.1668L10.4882%2027.223L13.1833%2029.4112L18.9073%2029.5782L21.7693%2031.5696L24.1722%2031.1582L26.9508%2035.654L28.34%2035.1114L28.8468%2032.6608L31.8818%2031.0271L34.2847%2032.1182L36.4312%2030.3473L38.9414%2030.5918L41.1296%2030.9257H41.4635L43.9022%2035.3737L45.1662%2034.9623L45.4167%2032.3746L43.5027%2029.3874L42.9959%2027.3422L45.1424%2024.7545L47.2889%2021.6182L45.6432%2019.4359C45.6432%2019.4359%2046.4005%2018.6191%2046.5257%2018.2076C46.6509%2017.7962%2046.9073%2015.7571%2046.9073%2015.7571L49.3102%2013.9862L49.185%2010.987C49.185%2010.987%2051.3852%209.10288%2051.3852%208.69743C51.3852%208.51856%2050.9678%207.94616%2050.4967%207.36183C49.9363%206.66421%2048.9745%205.5339%2048.3126%206.21363L45.8281%2010.3789L45.0112%2012.6208L43.0138%2012.9189L41.1177%2014.4155L39.3707%2013.6165L39.7225%2012.3703L38.1841%2012.0722C38.1841%2012.0722%2037.5957%2012.5134%2037.4646%2012.9189C37.3751%2013.1991%2037.1048%2014.2142%2036.8603%2015.4186C36.8126%2015.6512%2035.978%2016.3772%2035.978%2016.3772L34.714%2014.2485L35.6251%2010.987L35.1433%2010.033L32.8656%2011.5296L31.846%2010.8797L33.0266%208.18466L31.5121%207.00408L26.9686%207.84479C26.9686%207.84479%2016.7012%207.51089%2017.375%207.51089C18.0487%207.51089%2012.8256%206.87886%2012.8256%206.87886L9.41499%206.74173L9.9218%208.23832L7.64412%207.69573L7.13731%208.92401L7.76934%209.87801L6.70801%2012.7519L7.21482%2022.1548L7.22675%2022.1668Z'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M14.1902%2039.0763L12.9857%2037.7705L11.3759%2037.9732L10.076%2039.1776L7.26172%2038.9749H9.06836L10.5769%2037.8719L9.37245%2036.9715L9.8733%2033.9604L12.3835%2034.4613L13.2839%2037.7705'%20fill='%23E0988D'/%3e%3cpath%20d='M14.1902%2039.0763L12.9857%2037.7705L11.3759%2037.9732L10.076%2039.1776L7.26172%2038.9749H9.06836L10.5769%2037.8719L9.37245%2036.9715L9.8733%2033.9604L12.3835%2034.4613L13.2839%2037.7705'%20stroke='%231B3928'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M18.0605%2037.4961L19.6585%2039.094'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M20.2969%2040.0005L22.3003%2041.038'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M23.6709%2041.7593L25.8055%2041.5327L26.366%2043.8939L24.458%2044.7882L23.6709%2041.7593Z'%20fill='%2322382A'/%3e%3c/svg%3e",Ue="data:image/svg+xml,%3csvg%20width='45'%20height='47'%20viewBox='0%200%2045%2047'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.07197%2010.4416L9.90289%200.877099C10.5706%200.152945%2011.6898%200.0683036%2012.4609%200.684305L14.4782%202.30189C15.2259%202.89909%2016.3074%202.84266%2016.9845%202.16083L18.5363%200.609068C18.889%200.256395%2019.3686%200.0588989%2019.8671%200.0588989H42.598C43.6372%200.0588989%2044.4789%200.90061%2044.4789%201.93982V38.1757C44.4789%2038.4673%2044.413%2038.7541%2044.2814%2039.0174L41.239%2045.1022C40.9192%2045.7417%2040.2703%2046.1414%2039.5556%2046.1414H11.0644C10.486%2046.1414%209.9405%2045.8781%209.58313%2045.422L5.37928%2040.0707C5.12065%2039.7416%204.97958%2039.3278%204.97958%2038.9093V17.4621C4.97958%2016.9401%204.76327%2016.4417%204.38239%2016.089L1.17542%2013.0937C0.418351%2012.3883%200.37603%2011.2033%201.07667%2010.4416H1.07197Z'%20fill='white'/%3e%3cpath%20d='M35.8195%2019.2533L11.2949%2032.1475V39.3469L14.5412%2044.6119H39.304L42.241%2039.3469V19.2533H35.8195Z'%20fill='%23EFB138'/%3e%3cpath%20d='M14.5799%208.50818L19.5227%203.45795H33.384M14.5799%208.50818L9.63714%2013.5584L8.13281%2015.9224V37.6276L10.7117%2041.9257H36.2852L39.5087%2037.6276V3.45795H33.384M14.5799%208.50818H29.1934L33.384%203.45795'%20stroke='%2327372A'%20stroke-width='2'/%3e%3cpath%20d='M18.4746%2030.3189C18.4746%2024.1517%2024.3421%2016.3704%2024.3421%2016.3704C24.3421%2016.3704%2029.7049%2024.1758%2030.0835%2030.3189C30.182%2031.9177%2029.8373%2036.5342%2024.3421%2036.5342C19.3317%2036.5342%2018.4746%2032.9206%2018.4746%2030.3189Z'%20stroke='%23223829'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M21.5908%2029.4769C21.3615%2030.5061%2021.3642%2032.6527%2023.209%2033.0055'%20stroke='%23223829'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.83008%2014.3743L7.28125%2012.0663L11.6086%207.28729L14.1574%209.59521'%20stroke='%2327372A'%20stroke-width='2'/%3e%3cpath%20d='M3.60938%2011.6396L5.8396%2013.6591L13.0518%205.69399L10.8216%203.67456L3.60938%2011.6396Z'%20stroke='%2327372A'%20stroke-width='2'/%3e%3c/svg%3e",qe="data:image/svg+xml,%3csvg%20width='42'%20height='43'%20viewBox='0%200%2042%2043'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17.1813%2021.4799C17.1813%2021.4799%2022.2618%2013.0369%2028.7384%2018.0168C35.215%2022.9967%2016.443%2040.2452%2016.443%2040.2452C16.443%2040.2452%20-0.302109%2024.2987%205.59056%2018.104C11.4832%2011.9094%2017.188%2021.4799%2017.188%2021.4799H17.1813Z'%20fill='%23F4B536'/%3e%3cpath%20d='M22.1006%2020.5402C22.1006%2020.5402%2025.7316%2014.0234%2032.2081%2019.0033C38.6847%2023.9832%2019.9127%2041.2317%2019.9127%2041.2317C19.9127%2041.2317%203.16762%2025.2852%209.06029%2019.0906C14.953%2012.8959%2020.6577%2022.4664%2020.6577%2022.4664L22.1006%2020.5402Z'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M36.4492%2014.3321L40.9996%209.78174'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M29.6377%209.64088L31.6444%203.53345'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M5.55038%2013.0705L1%208.52014'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M13.0341%208.37916L11.0273%202.27173'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3cpath%20d='M21.376%207.1979L21.5371%200.768311'%20stroke='%2322382A'%20stroke-width='2'%20stroke-miterlimit='10'/%3e%3c/svg%3e",$e={[G]:"basic needs loans",[M]:"eco friendly loans",[O]:"refugees",[v]:"borrowers",[R]:"US entrepreneurs",[A]:"women"},He={[G]:"basic needs loan",[M]:"eco friendly loan",[O]:"refugee",[v]:"borrower",[R]:"US entrepreneur",[A]:"woman"},g={COMPLETED:"completed",EXPIRED:"expired",IN_PROGRESS:"in-progress"},ze=1,et=new Date().getFullYear()-1,Be=2026,Ve=100,tt=50;function te(y,u){return!y||y>1?$e[u]||"loans":He[u]||"loan"}function at({apollo:y}={}){const u=y||ee("apollo"),T=ee("$kvTrackEvent"),f=L([]),S=L(0),I=L(!0),U=L(null),q=L(null),d=L(null),Q=L(!1),k=L(null),C=L(!1),w=Y(()=>{const e=d.value,t=f.value;if((e==null?void 0:e.category)===v){if(C.value)return q.value||0;const s=(e==null?void 0:e.loanTotalAtStart)||0;return Math.max(0,(U.value||0)-s)}const a=t==null?void 0:t.find(s=>s.id===(e==null?void 0:e.category));if(C.value)return(a==null?void 0:a.progressForYear)||0;const i=(a==null?void 0:a.totalProgressToAchievement)||0,n=(e==null?void 0:e.loanTotalAtStart)||0;return Math.max(0,i-n)}),Z=Y(()=>{var e;return w.value>=((e=d.value)==null?void 0:e.target)});function re(e){const t=d.value;if(!t||t.status!==g.IN_PROGRESS)return!1;const a=t.target||0;return e>0&&e===a}function b(e){if(!e)return;const t=e.goals||[],a=new Date().getFullYear(),i=t.filter(n=>!(n.status===g.EXPIRED||n.status===g.COMPLETED&&n.dateStarted&&new Date(n.dateStarted).getFullYear()<a));d.value={...i[0]}}function ie(e,t){return[{id:"1",name:"Women",description:"Open doors for women around the world",eventProp:"women",customImage:Me,loanCount:e==null?void 0:e[A],title:"women",badgeId:A},{id:"2",name:"Choose as I go",description:"Support a variety of borrowers",eventProp:"help-everyone",customImage:qe,loanCount:t,title:null,badgeId:v},{id:"3",name:"Climate Action",description:"Support the front lines of the climate crisis",eventProp:"climate",customImage:Oe,loanCount:e==null?void 0:e[M],title:"climate action",badgeId:M},{id:"4",name:"Basic Needs",description:"Clean water, healthcare, and sanitation",eventProp:"basic-needs",customImage:Ue,loanCount:e==null?void 0:e[G],title:"basic needs",badgeId:G},{id:"5",name:"Refugees",description:"Transform the future for refugees",eventProp:"refugees",customImage:Ge,loanCount:e==null?void 0:e[O],title:"refugees",badgeId:O},{id:"6",name:"U.S. Entrepreneurs",description:"Support small businesses in the U.S.",eventProp:"us-entrepreneur",customImage:Re,loanCount:e==null?void 0:e[R],title:"US entrepreneurs",badgeId:R}]}function se(e,t,a,i=0){const{getLoanFindingUrl:n}=Se(),s=Math.max(0,e-i),o=te(s,t),l=`Support ${s} more ${o} to reach your goal`,r=encodeURIComponent(l),c=n(t,a.currentRoute.value);return s>0?`${c}?header=${r}`:`${c}`}function oe(e,t=A){const a=e==null?void 0:e.find(i=>i.id===t);return(a==null?void 0:a.progressForYear)||0}async function $(e,t="cache-first"){try{return(await u.query({query:De,variables:{year:e},fetchPolicy:t})).data.userAchievementProgress.tieredLendingAchievements}catch(a){return h(a,"Failed to fetch categories progress by year"),null}}async function E(e,t="cache-first"){var a,i,n;try{const o=(n=(i=(a=(await u.query({query:be,variables:{year:e},fetchPolicy:t})).data)==null?void 0:a.my)==null?void 0:i.lendingStats)==null?void 0:n.loanStatsByYear;return{count:(o==null?void 0:o.count)||0,amount:(o==null?void 0:o.amount)||0}}catch(s){return h(s,"Failed to fetch loan stats by year"),null}}const j=async(e,t="network-only")=>{try{return(await E(e,t)).count||0}catch(a){return h(a,"Failed to fetch previous support-all loan count"),null}};async function le(e,t,a="cache-first"){var i;try{if(e===v)return await j(t);const n=await $(t,a);return((i=n==null?void 0:n.find(o=>o.id===e))==null?void 0:i.progressForYear)||0}catch(n){return h(n,"Failed to fetch category loan count by year"),null}}async function N(e="cache-first"){var t,a,i,n,s;try{const o=await u.query({query:Te,fetchPolicy:e}),l=((a=(t=o.data)==null?void 0:t.my)==null?void 0:a.userPreferences)||null;return U.value=((s=(n=(i=o.data)==null?void 0:i.my)==null?void 0:n.loans)==null?void 0:s.totalCount)||0,k.value=l,l?JSON.parse(l.preferences||"{}"):{}}catch(o){return h(o,"Failed to load preferences"),null}}function J(e,t,a,i=[]){const n=he(e,t),s={};if(!(e!=null&&e.length)||!(t!=null&&t.length))return{allTime:n,yearSpecific:s};const o=we(e,t),l=new Map;return i.forEach(r=>{var m;const c=ye(r);if(((m=r==null?void 0:r.loan)==null?void 0:m.id)!=null&&c!=null){const F=new Date(c).getFullYear();l.set(r.loan.id,{year:F})}}),o.forEach(r=>{if(!r)return;const c=l.get(r.id),m=(c==null?void 0:c.year)||null;m&&m===a&&Pe(r).forEach(P=>{s[P]=(s[P]||0)+1})}),{allTime:n,yearSpecific:s}}function X(e,t){const a=(t==null?void 0:t.allTime)||{},i=(t==null?void 0:t.yearSpecific)||{};return!(e!=null&&e.length)||Object.keys(a).length===0?(e==null?void 0:e.map(n=>({...n})))||[]:e.map(n=>{const s=a[n.id],o=i[n.id];if((s||o)&&n.totalProgressToAchievement!==void 0){const r=(n.totalProgressToAchievement||0)+(s||0),c=n.progressForYear||0,m=n.progressForYear!==void 0?c+(o||0):n.progressForYear;return{...n,totalProgressToAchievement:r,progressForYear:m}}return{...n}})}async function K(e,t="network-only",a={}){try{const i=await $(e,t);f.value=X(i,a)}catch(i){return h(i,"Failed to load progress"),null}}async function ce({loans:e=[],year:t=null,increment:a=!1,addBasketLoans:i=!1}={}){var n,s,o,l,r,c,m,F;if(((n=d.value)==null?void 0:n.category)===v)return a?(S.value+=1,{totalProgress:w.value+S.value,hasContributingLoans:!0}):i?{totalProgress:w.value+e.length,hasContributingLoans:e.length>0}:{totalProgress:w.value,hasContributingLoans:e.length>0};try{const P=e.map(p=>p.id),B=await u.query({query:Ce,variables:{loanIds:P,year:t}}),V=(t?((o=(s=B.data)==null?void 0:s.postCheckoutAchievements)==null?void 0:o.yearlyProgress)||[]:((r=(l=B.data)==null?void 0:l.postCheckoutAchievements)==null?void 0:r.allTimeProgress)||[]).find(p=>{var D;return p.achievementId===((D=d.value)==null?void 0:D.category)}),W=(V==null?void 0:V.totalProgress)||0,x=(((m=(c=B.data)==null?void 0:c.postCheckoutAchievements)==null?void 0:m.overallProgress)||[]).find(p=>{var D;return p.achievementId===((D=d.value)==null?void 0:D.category)}),Le=(x==null?void 0:x.contributingLoanIds)||[],z=P.some(p=>Le.includes(String(p)));if(!t){const p=((F=d.value)==null?void 0:F.loanTotalAtStart)||0;return{totalProgress:Math.max(0,W-p),hasContributingLoans:z}}return{totalProgress:W,hasContributingLoans:z}}catch(P){return h(P,"Failed to get post-checkout progress"),{totalProgress:null,hasContributingLoans:!1}}}async function H(e,t=!0){var s,o,l;(s=k.value)!=null&&s.id||(await _e(u,{goals:[]}),await N("network-only"));const a=JSON.parse(((o=k.value)==null?void 0:o.preferences)||"{}"),i=a.goals||[],n=i.findIndex(r=>r.goalName===e.goalName);if(n!==-1)i[n]={...i[n],...e};else{let r;if(e.category===v)r=U.value||0;else{const c=(l=f.value)==null?void 0:l.find(m=>m.id===e.category);r=(c==null?void 0:c.totalProgressToAchievement)||0}i.push({...e,loanTotalAtStart:r})}await _(u,k.value,a,{goals:i}),t&&b({goals:i})}async function de({currentGoalProgress:e=0,category:t="post-checkout"}={}){var a,i;if(![g.COMPLETED,g.EXPIRED].includes((a=d.value)==null?void 0:a.status)&&(e&&e>=((i=d.value)==null?void 0:i.target)||d.value&&Z.value)){const n=d.value.category,s=d.value.target;d.value={...d.value,status:g.COMPLETED},await H({...d.value}),T(t,"show","annual-goal-complete",n,s),Q.value=!0}}async function ue(){var s,o;if(C.value||!d.value||!((s=f==null?void 0:f.value)!=null&&s.length))return;const e=d.value;if(e.category===v)return;const t=(o=f.value)==null?void 0:o.find(l=>l.id===e.category),a=(t==null?void 0:t.totalProgressToAchievement)||0,i=e.loanTotalAtStart||0,n=a-i;if(n<0){const l={category:e.category,goalName:e.goalName,allTimeProgress:a,loanTotalAtStart:i,adjustedProgress:n,target:e.target};h("Negative goal progress detected, correcting loanTotalAtStart","warn",l),await H({...e,loanTotalAtStart:a})}}async function me({freshProgressLoans:e=[],supportAllCounterLoans:t=[],year:a=new Date().getFullYear(),yearlyProgress:i=!1,tieredAchievements:n=[],transactions:s=[]}={}){var r,c;I.value=!0,C.value=i;const o=await N();let l={allTime:{},yearSpecific:{}};if(e!=null&&e.length&&(n!=null&&n.length)&&(l=J(e,n,a,s)),await K(a,"network-only",l),b(o),i&&((r=d.value)==null?void 0:r.category)===v){const m=await E(a,"network-only");q.value=(m==null?void 0:m.count)||0}((c=d.value)==null?void 0:c.category)===v&&t.length>0&&!S.value&&(S.value=t.length-1),await ue(),I.value=!1}async function ge(e=new Date){const t=await N(),a=t.goals||[],i=e.getFullYear(),n=t.goalsRenewedDate?new Date(t.goalsRenewedDate).getFullYear():null,s=a.some(r=>r.status===g.EXPIRED);if(n>i||s)return{expiredGoals:a,showRenewedAnnualGoalToast:!1};const o=a.map(r=>(r.dateStarted?new Date(r.dateStarted).getFullYear():null)<i?{...r,status:g.EXPIRED}:null).filter(r=>r!==null);o.some(r=>r.status===g.EXPIRED)&&(t.goals=o,t.goalsRenewedDate=e.toISOString(),await _(u,k.value,t,{goals:o}),b({goals:o}));const l=!!o.length&&!o.some(r=>r.status===g.COMPLETED);return{expiredGoals:o,showRenewedAnnualGoalToast:l}}async function ve(){var l;const e=await N("network-only"),t=e.goals||[],a=new Date().getFullYear(),i=e.hideGoalCard||!1,n=t.find(r=>r.status!==g.COMPLETED&&!i?!1:(r.dateStarted?new Date(r.dateStarted).getFullYear():null)===a&&a>=Be);if(!n)return{wasFixed:!1};let s;if(n.category===v){const r=await E(a,"network-only");s=(r==null?void 0:r.count)||0}else{await K(a);const r=(l=f.value)==null?void 0:l.find(c=>c.id===n.category);s=(r==null?void 0:r.progressForYear)||0}if(C.value=!0,s>=n.target)return{wasFixed:!1};n.category===v&&(q.value=s);const o=t.map(r=>r.goalName===n.goalName?{...r,status:g.IN_PROGRESS}:r);return await _(u,k.value,e,{goals:o}),b({goals:o}),{wasFixed:!0}}async function fe(e=!0){const t=await N("network-only");await _(u,k.value,t,{hideGoalCard:e})}const ke=Y(()=>{var t;return JSON.parse(((t=k.value)==null?void 0:t.preferences)||"{}").hideGoalCard||!1}),pe=Y(()=>{var t;const e=Number((t=d==null?void 0:d.value)==null?void 0:t.target);return!e||Number.isNaN(e)||w.value<=0?0:Math.min(Math.round(w.value/e*100),Ve)});return{applyFreshProgressToGoalData:X,calculateGoalFreshProgressAdjustments:J,checkCompletedGoal:de,getCategories:ie,getCategoriesProgressByYear:$,getCategoryLoanCountByYear:le,getCategoryLoansLastYear:oe,getCtaHref:se,getGoalDisplayName:te,getLoanStatsByYear:E,getPostCheckoutProgressByLoans:ce,goalProgress:w,goalProgressPercentage:pe,isProgressCompletingGoal:re,loadGoalData:me,loadPreferences:N,loading:I,storeGoalPreferences:H,userGoal:d,userGoalAchieved:Z,userGoalAchievedNow:Q,userPreferences:k,fixIncorrectlyCompletedGoals:ve,renewAnnualGoal:ge,hideGoalCard:ke,setHideGoalCardPreference:fe,getSupportAllLoanCountByYear:j}}export{Ve as C,g as G,tt as H,et as L,ze as S,at as u};
