import{j as B,g as L}from"./entry-vue.esm-bundler-C0PPCo9W96.js";import{l as O}from"./entry-logReadQueryError-Codcl0QZ_g.js";import{d as Y}from"./entry-achievementUtils-Cf0LlmQMSn.js";const Q=`query UserAchievementProgress($publicId: String, $year: Int) {
  userAchievementProgress(publicId: $publicId, year: $year) {
    id
    lendingAchievements {
      id
      description
      milestoneProgress {
        earnedAtDate
        id
        milestoneStatus
        progress
        target
      }
    }
    tieredLendingAchievements {
      id
      description
      totalProgressToAchievement
      progressForYear
	  loanPurchases (limit: 3) {
        loan {
          id
		  name
          image {
			id
            hash
			url
          }
        }
      }
      tiers {
        target
        tierStatement
        completedDate
        learnMoreURL
      }
    }
  }
}
`,x={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserAchievementProgress"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"publicId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"year"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAchievementProgress"},arguments:[{kind:"Argument",name:{kind:"Name",value:"publicId"},value:{kind:"Variable",name:{kind:"Name",value:"publicId"}}},{kind:"Argument",name:{kind:"Name",value:"year"},value:{kind:"Variable",name:{kind:"Name",value:"year"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lendingAchievements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"milestoneProgress"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"earnedAtDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"milestoneStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"progress"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"target"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"tieredLendingAchievements"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProgressToAchievement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"progressForYear"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"loanPurchases"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"IntValue",value:"3"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"loan"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hash"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"tiers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"target"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tierStatement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"completedDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"learnMoreURL"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:724,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:Q}}},J=`# The preview parameter should come from a route query param and
# should not be passed in manually. It is handled by src/api/ContentfulPreviewLink.js
query contentfulEntries(
	$contentType: String!
	$contentKey: String
	$preview: Boolean
	$limit: Int
) {
	contentful {
		entries(
			contentType: $contentType
			contentKey: $contentKey
			preview: $preview
			limit: $limit
		)
	}
}
`,H={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"contentfulEntries"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contentType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contentKey"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"preview"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentful"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[{kind:"Argument",name:{kind:"Name",value:"contentType"},value:{kind:"Variable",name:{kind:"Name",value:"contentType"}}},{kind:"Argument",name:{kind:"Name",value:"contentKey"},value:{kind:"Variable",name:{kind:"Name",value:"contentKey"}}},{kind:"Argument",name:{kind:"Name",value:"preview"},value:{kind:"Variable",name:{kind:"Name",value:"preview"}}},{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}}],directives:[]}]}}]}}],loc:{start:0,end:422,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:J}}},C="equity",W="wrd-2024-challenge",K="wrd-23-challenge",X="earthday-23-challenge",z="earth-day-2024-challenge",Z="iwd-challenge",b="iwd-2024-challenge",ee="climate-challenge",ne="2BB-23-Roadto3BB",te="2BB-23-Thanks",D="womens-equality",E="us-economic-equality",T="climate-action",_="refugee-equality",I="basic-needs",U="support-all",ie={[D]:{gender:["female"]},[E]:{country:["PR","US"]},[T]:{tag:["8","9"]},[_]:{attribute:["28"]},[I]:{sector:["6","10","20","21"]}},re={[D]:"women",[E]:"kiva-u-s",[T]:"eco-friendly",[_]:"refugees-and-i-d-ps",[I]:"basic-needs"},Te={[D]:"woman",[E]:"entrepreneur",[T]:"person",[_]:"refugee",[I]:"person",[U]:"person"},_e=100,ae=["PR","US"],se="female",le="refugees/displaced",oe=[6,10,20,21],ce="water and sanitation",de="clean energy",ue=["#eco-friendly","#sustainable ag"],me=r=>{var S,h,g,A,N,y,F;const o=[];return ae.includes((h=(S=r==null?void 0:r.geocode)==null?void 0:S.country)==null?void 0:h.isoCode)&&o.push(E),(r==null?void 0:r.gender)===se&&o.push(D),(g=r==null?void 0:r.themes)!=null&&g.some(v=>(v==null?void 0:v.toLowerCase())===le)&&o.push(_),(oe.includes((A=r==null?void 0:r.sector)==null?void 0:A.id)||(N=r==null?void 0:r.themes)!=null&&N.some(v=>(v==null?void 0:v.toLowerCase())===ce))&&o.push(I),((y=r==null?void 0:r.tags)!=null&&y.some(v=>ue.includes(v==null?void 0:v.toLowerCase()))||(F=r==null?void 0:r.themes)!=null&&F.some(v=>(v==null?void 0:v.toLowerCase())===de))&&o.push(T),o},ve=(r,o)=>{if(!(r!=null&&r.length)||!(o!=null&&o.length))return[];const S=new Set;o.forEach(g=>{(g.loanPurchases||[]).forEach(N=>{var y;((y=N==null?void 0:N.loan)==null?void 0:y.id)!=null&&S.add(N.loan.id)})});const h=new Set;return r.filter(g=>(g==null?void 0:g.id)==null||h.has(g.id)?!1:(h.add(g.id),!S.has(g.id)))},ke=(r,o)=>{if(!(r!=null&&r.length)||!(o!=null&&o.length))return{};const S=ve(r,o),h={};return S.forEach(g=>{if(!g)return;me(g).forEach(N=>{h[N]=(h[N]||0)+1})}),h};function Ie(){const r=B(),o=B(),S=e=>{var t,n,i,a,s,l,c,k,p,u,f,d,m;return{id:((n=(t=e==null?void 0:e.fields)==null?void 0:t.key)==null?void 0:n.replace(/-level-\d+/,""))??"",level:+(((a=(i=e==null?void 0:e.fields)==null?void 0:i.key)==null?void 0:a.replace(/\D/g,""))??""),levelName:((s=e==null?void 0:e.fields)==null?void 0:s.levelName)??"",challengeName:((l=e==null?void 0:e.fields)==null?void 0:l.challengeName)??"",imageUrl:((u=(p=(k=(c=e==null?void 0:e.fields)==null?void 0:c.badgeImage)==null?void 0:k.fields)==null?void 0:p.file)==null?void 0:u.url)??"",shareFact:((f=e==null?void 0:e.fields)==null?void 0:f.shareFact)??"",shareFactFootnote:((d=e==null?void 0:e.fields)==null?void 0:d.shareFactFootnote)??"",shareFactUrl:((m=e==null?void 0:e.fields)==null?void 0:m.shareFactUrl)??""}},h=async(e,t=null)=>{var n,i,a,s;try{const l=await e.query({query:x,variables:{publicId:t},fetchPolicy:"network-only"});r.value=[...((i=(n=l.data)==null?void 0:n.userAchievementProgress)==null?void 0:i.lendingAchievements)??[],...((s=(a=l.data)==null?void 0:a.userAchievementProgress)==null?void 0:s.tieredLendingAchievements)??[]]}catch(l){O(l,"useBadgeData userAchievementProgressQuery")}},g=e=>{e.query({query:H,variables:{contentType:"challenge",limit:200}}).then(t=>{var n,i,a;o.value=(((a=(i=(n=t.data)==null?void 0:n.contentful)==null?void 0:i.entries)==null?void 0:a.items)??[]).map(s=>S(s))}).catch(t=>{O(t,"useBadgeData contentfulEntriesQuery")})},A=(e,t)=>{const n=[];return(e==null?void 0:e.length)>0&&(t==null?void 0:t.length)>0&&e.forEach(i=>{var s;const a=t.filter(l=>l.id===i.id);if(i&&a.length>0){const l=[...i.tiers??[]].map((d,m)=>{const w=JSON.parse(JSON.stringify(d));return w.level=m+1,w});l.sort((d,m)=>d.target-m.target),a.sort((d,m)=>d.level-m.level);const c=l.filter(d=>!!d.completedDate),k=c.length>0||(i==null?void 0:i.totalProgressToAchievement)>0,p=k?(s=c==null?void 0:c[c.length-1])==null?void 0:s.level:void 0,{milestoneProgress:u}=i,f=u==null?void 0:u.map(d=>{var m;return{...d,earnedAtDate:(m=d.earnedAtDate)==null?void 0:m.replace("[UTC]","")}});n.push({id:i.id,challengeName:a[0].challengeName,description:i.description,contentfulData:a,achievementData:{...i,tiers:l.map(d=>{var m;return{...d,completedDate:(m=d.completedDate)==null?void 0:m.replace("[UTC]","")}}),milestoneProgress:f},hasStarted:k,level:p})}}),n},N=e=>{const t=(e.level===e.achievementData.tiers.length?e.level-1:e.level)??0,n=e.achievementData.tiers[t];return{...e.contentfulData.find(i=>i.level===(n==null?void 0:n.level)),...n}},y=L(()=>A(r.value,o.value)),F=e=>{const t=e!=null&&e.levelName?` (level ${e==null?void 0:e.levelName})`:"",n=(e==null?void 0:e.challengeName)??"";return t?`${n}${t}`:n},v=(e,t)=>{var s,l,c,k,p,u;const n=(l=(s=e==null?void 0:e.achievementData)==null?void 0:s.tiers)==null?void 0:l.findIndex(f=>(f==null?void 0:f.level)===t),i=(k=(c=e==null?void 0:e.achievementData)==null?void 0:c.tiers)==null?void 0:k[n],a=((p=e==null?void 0:e.contentfulData)==null?void 0:p[n])||(typeof((u=e==null?void 0:e.contentfulData)==null?void 0:u.length)>"u"?e.contentfulData:void 0);return{...e,contentfulData:a,achievementData:i,tierName:F(a)||e.challengeName}},$=(e,t)=>{const n="/lend/filter",i=re[e]||"",a=i?`/lend-by-category/${i}`:n,s=t==null?void 0:t.path;if(s!==a){if(s===n){const l=JSON.parse(JSON.stringify((t==null?void 0:t.query)??{})),c=ie[e];return Object.keys(c).forEach(k=>{l[k]=c[k]}),`${n}?${new URLSearchParams(l).toString()}`}return a}},q=e=>e.includes("badge_")&&e.includes("social_share")&&Y.some(t=>e.includes(t)),V=e=>{var t,n,i,a,s,l,c,k;if((n=(t=e==null?void 0:e.achievementData)==null?void 0:t.milestoneProgress)!=null&&n.length){if((s=(a=(i=e.achievementData)==null?void 0:i.milestoneProgress)==null?void 0:a[0])==null?void 0:s.earnedAtDate){const u=((l=e.contentfulData)==null?void 0:l[0])??{};return{...e,contentfulData:u,levelName:F(u)}}}else if((k=(c=e==null?void 0:e.achievementData)==null?void 0:c.tiers)!=null&&k.length){const p=JSON.parse(JSON.stringify(e.achievementData.tiers));p.sort((d,m)=>d.completedDate===m.completedDate?m.level-d.level:new Date(m.completedDate)-new Date(d.completedDate));const u=p[0].level-1,f=e.contentfulData[u];return{...e,contentfulData:f,achievementData:p[0],levelName:F(f)}}return{}},R=e=>{const t=[C,D,E,I,T,_];let n;if(e!=null&&e.length){const i=JSON.parse(JSON.stringify(e));i.sort((a,s)=>t.indexOf(a.id)-t.indexOf(s.id));for(let a=0;a<i.length;a+=1){const s=i[a];(!n||(s.level??1)>n.level)&&(n=s)}}return n??{}},P=e=>{const t=[];return e==null||e.forEach(n=>{var i,a,s,l,c,k,p;if((a=(i=n==null?void 0:n.achievementData)==null?void 0:i.tiers)!=null&&a.length){const{tiers:u}=n.achievementData;u.forEach(f=>{f.completedDate&&t.push({...n,earnedAtDate:f.completedDate,level:f.level})})}if((l=(s=n==null?void 0:n.achievementData)==null?void 0:s.milestoneProgress)!=null&&l.length){const u=(p=(k=(c=n.achievementData)==null?void 0:c.milestoneProgress)==null?void 0:k[0])==null?void 0:p.earnedAtDate;u&&t.push({...n,earnedAtDate:u,level:0})}}),t},M=L(()=>{const e=P(y.value);return e.sort((t,n)=>new Date(t.earnedAtDate)-new Date(n.earnedAtDate)),e}),G=(e,t)=>{switch(e){case D:return`for helping ${t} women`;case T:return`for helping ${t} climate stewards with eco-friendly projects`;case E:return`for helping ${t} people in the United States or Puerto Rico`;case I:return`for helping ${t} people in need of housing, healthcare, clean water or sanitation`;case _:return`for helping ${t} refugees or displaced people`;case C:return"for helping your first person on kiva";case K:case W:return"for helping a refugee on world refugee day";case X:case z:return"for contributing to a climate project on earth day";case Z:case b:return"for helping a woman on international womenâ€™s day";case ee:return"for contributing to 3 eco-friendly projects";case ne:return"for helping us kickstart our goal to reach $3b in total impact";case te:return"for helping us reach $2b in total impact";default:return""}},j=(e,t)=>!(e!=null&&e.length)||!t||Object.keys(t).length===0?(e==null?void 0:e.map(n=>({...n})))||[]:e.map(n=>{const i=t[n.id];if(i&&n.totalProgressToAchievement!==void 0){const s=(n.totalProgressToAchievement||0)+i;return{...n,totalProgressToAchievement:s}}return{...n}});return{badgeAchievementData:r,badgeContentfulData:o,badgeData:y,combineBadgeData:A,completedBadges:M,fetchAchievementData:h,fetchContentfulData:g,getActiveTierData:N,getCompletedBadges:P,getContentfulLevelData:S,getEarnedBadgeExplanation:G,getHighestPriorityDisplayBadge:R,getLastCompletedBadgeLevelData:V,getLevelName:F,getLoanFindingUrl:$,getTierBadgeDataByLevel:v,getTierBadgeHeadline:e=>{switch(e){case D:return"lending to women";case T:return"supporting climate solutions";case E:return"lending to U.S entrepreneurs";case I:return"supporting basic needs";case _:return"lending to refugees";default:return"lending"}},ID_SUPPORT_ALL:U,ID_BASIC_NEEDS:I,ID_CLIMATE_ACTION:T,ID_REFUGEE_EQUALITY:_,ID_US_ECONOMIC_EQUALITY:E,ID_WOMENS_EQUALITY:D,isBadgeKeyValid:q,getLevelCaption:e=>{switch(e.level){case 1:return"One";case 2:return"Two";case 3:return"Three";case 4:return"Four";case 5:return"Five";case 6:return"Six";case 7:return"Seven";case 8:return"Eight";case 9:return"Nine";case 10:return"Ten";default:return e.level}},getAllCategoryLoanCounts:e=>(e==null?void 0:e.reduce((t,n)=>(t[n.id]=n.totalProgressToAchievement??0,t),{}))??{[D]:0,[E]:0,[I]:0,[T]:0,[_]:0},allAchievementsCompleted:e=>e!=null&&e.length?e.filter(n=>{var i;return(i=n==null?void 0:n.tiers)==null?void 0:i.length}).every(n=>{const i=n==null?void 0:n.tiers;return i!=null&&i.length?i.every(a=>!!a.completedDate):!1}):!1,updateBadgeDataWithFreshProgress:(e,t)=>{var i;if(!(e!=null&&e.length)||!(t!=null&&t.length)||!((i=r.value)!=null&&i.length))return{};const n=ke(e,t);return Object.keys(n).length>0&&(r.value=j(r.value,n)),n}}}export{Te as C,I,_e as M,E as a,T as b,_ as c,D as d,C as e,U as f,me as g,ke as h,ve as i,Ie as u};
