import{r as O}from"./entry-mdi-BJHOrBfjV3.js";import{g as f}from"./entry-numeral-DJCTM12wUX.js";import{p as M,t as S}from"./entry-time-left-mixin-BgOgttSZrl.js";import{B}from"./entry-BorrowerImage-WXGsRE2huI.js";import{S as K,B as T}from"./entry-SummaryTag-BL5nRGkmuD.js";import{K as q}from"./entry-KvLoadingParagraph-B1vku9KEXS.js";import{r as D,w as F}from"./entry-loanUtils-5D9a5yj3H7.js";import{c as V}from"./entry-observerUtils-DveHpw6JZJ.js";import{c as u,F as A,d as n,P as z,f as s,b as p,J as g,e as l,K as m,r as d,o,a as w}from"./entry-vue.esm-bundler-Bf_Yeyugwo.js";import{w as E}from"./entry-KvMaterialIcon-DcajXwg-0j.js";import{_ as H}from"./entry-KvLoadingPlaceholder-DUZzoT9CoU.js";import"./entry-KvWwwHeader-CVdIzOPj6Q.js";import{q as R}from"./entry-KvProgressBar-CQtXD0YVwH.js";import{_ as U}from"./entry-_plugin-vue_export-helper-DlAUqK2UKH.js";import{w as Q,a as j}from"./entry-exports-CudK1O5XNw.js";const v=f`
	fragment loanFields on LoanBasic {
		id
		distributionModel
		geocode {
			country {
				id
				name
			}
		}
		image {
			id
			hash
		}
		name
		use
		loanAmount
		loanFundraisingInfo {
			id
			fundedAmount
			reservedAmount
		}
		fundraisingPercent @client
		dedicationToKiva(publicId: $publicId)
		dedications(publicId: $publicId) {
			values {
				id
				recipientName
			}
		}
	}`,J=f`
	${v}
	query welcomeLoanCard($loanId: Int!, $publicId: String!) {
		lend {
			loan(id: $loanId) {
				id
				...loanFields
			}
		}
	}`,b={name:"NewHomePageLoanCard",emits:["dedication-click"],props:{loanId:{type:Number,required:!0},lenderPublicId:{type:String,default:""}},inject:["apollo","cookieStore"],mixins:[M,S],components:{BorrowerImage:B,BorrowerName:T,KvLoadingPlaceholder:H,KvLoadingParagraph:q,KvMaterialIcon:E,SummaryTag:K,KvProgressBar:R},data(){return{loan:null,mdiMapMarker:O,isLoading:!0,queryObserver:null,viewportObserver:null}},computed:{borrowerName(){var e;return((e=this.loan)==null?void 0:e.name)||""},countryISO(){var e,t,i;return((i=(t=(e=this.loan)==null?void 0:e.geocode)==null?void 0:t.country)==null?void 0:i.isoCode)||""},countryName(){var e,t,i;return((i=(t=(e=this.loan)==null?void 0:e.geocode)==null?void 0:t.country)==null?void 0:i.name)||""},distributionModel(){var e;return((e=this.loan)==null?void 0:e.distributionModel)||""},imageHash(){var e,t;return((t=(e=this.loan)==null?void 0:e.image)==null?void 0:t.hash)??""},loanUse(){var e,t,i;return((e=this.loan)==null?void 0:e.distributionModel)==="direct"?`Loan for ${(t=this.loan)==null?void 0:t.use}`:`Loan ${(i=this.loan)==null?void 0:i.use}`},fundraisingPercent(){var e,t;return(e=this.loan)!=null&&e.distributionModel?(((t=this.loan)==null?void 0:t.fundraisingPercent)??0)*100:0},unreservedAmount(){var e;return((e=this.loan)==null?void 0:e.unreservedAmount)??"0"},timeLeft(){var e;return((e=this.loan)==null?void 0:e.fundraisingTimeLeft)??""},allSharesReserved(){var e;return parseFloat((e=this.loan)==null?void 0:e.unreservedAmount)===0},inBorrowerProfilePage(){return this.$route.path.includes("funded")},loanAmount(){var e;return(e=this.loan)==null?void 0:e.loanAmount},dedications(){var i,c,a;const e=((c=(i=this.loan)==null?void 0:i.dedications)==null?void 0:c.values)??[];return(((a=this.loan)==null?void 0:a.dedicationToKiva)??!1)&&e.push({recipientName:"Kiva"}),e},dedicationsCopy(){return this.dedications.length>1?"Multiple recipients":this.dedications[0].recipientName}},methods:{createViewportObserver(){this.viewportObserver=V({targets:[this.$el],callback:e=>{e.forEach(t=>{t.target===this.$el&&t.intersectionRatio>0&&this.loadData()})}}),this.viewportObserver||this.loadData()},destroyViewportObserver(){this.viewportObserver&&this.viewportObserver.disconnect()},loadData(){this.queryObserver||(this.queryObserver=F({apollo:this.apollo,loanId:this.loanId,publicId:this.lenderPublicId,loanCardQuery:J,callback:e=>this.processQueryResult(e)}))},processQueryResult(e){var t,i;if(e.error){this.$showTipMsg("There was a problem loading your loan recommendations","error");try{Q(c=>{c.setTag("wizard_stage","results"),c.setTag("loan_id",this.loanId),j(e.error)})}catch{}}this.loan=((i=(t=e.data)==null?void 0:t.lend)==null?void 0:i.loan)||null,this.loan&&(this.isLoading=!1)},dedicationClickEvent(){this.$emit("dedication-click",{loanId:this.loanId,dedicationCopy:this.dedicationsCopy}),this.$router.push(`/dedication/${this.loanId}`)}},created(){const e=D({apollo:this.apollo,loanId:this.loanId,publicId:this.lenderPublicId,fragment:v});e&&(this.loan=e,this.isLoading=!1)},mounted(){this.loan?this.loadData():this.createViewportObserver()},beforeUnmount(){this.destroyViewportObserver()},watch:{loanId(e){this.queryObserver&&this.queryObserver.setVariables({loanId:e,publicId:this.lenderPublicId})}}},G=["id"],W={key:1,class:"tw-relative"},X={key:0},Y={key:5,class:"tw-text-left"},Z={class:"tw-m-0 tw-overflow-hidden tw-text-ellipsis tw-line-clamp-2 tw-text-md loan-use"},$={key:8,class:"tw-flex-auto tw-mb-2"},ee={class:"tw-flex"},te={class:"tw-flex-auto tw-text-left"},ie={class:"tw-text-h3 tw-m-0 progress-text tw-mb-2 tw-mt-2","data-testid":"bp-summary-amount-to-go"},re={class:"tw-flex-auto tw-text-right progress-text tw-mb-2 tw-mt-2","data-testid":"bp-summary-timeleft"},ae={lass:"tw-text-h3 tw-block tw-m-0"},oe={key:0};function ne(e,t,i,c,a,r){const h=d("kv-loading-placeholder"),_=d("borrower-image"),y=d("kv-material-icon"),k=d("summary-tag"),I=d("borrower-name"),x=d("kv-loading-paragraph"),L=d("kv-progress-bar"),N=d("router-link"),P=z("kv-track-event");return o(),u("div",{class:"tw-flex tw-flex-col card-container selected-card tw-rounded-xs",id:`${i.loanId}-loan-card`},[A((o(),s(N,{class:"link",is:r.allSharesReserved?"span":"router-link",to:`/lend/${i.loanId}`},{default:p(()=>[a.isLoading?(o(),s(h,{key:0,class:"tw-mb-1 tw-rounded",style:{width:"240px",height:"180px"}})):n("",!0),a.isLoading?n("",!0):(o(),u("div",W,[w(_,{class:"tw-relative tw-w-full tw-bg-black tw-rounded",alt:"photo of "+r.borrowerName,"aspect-ratio":3/4,"default-image":{width:336},hash:r.imageHash,images:[{width:336,viewSize:1024},{width:336,viewSize:768},{width:416,viewSize:480},{width:374,viewSize:414},{width:335,viewSize:375},{width:280}]},null,8,["alt","hash"]),r.countryName?(o(),u("div",X,[w(k,{class:"tw-absolute tw-bottom-2 tw-left-1 tw-text-primary","country-name":r.countryName},{default:p(()=>[w(y,{class:"tw-h-2.5 tw-w-2.5 tw-mr-0.5",icon:a.mdiMapMarker},null,8,["icon"]),g(" "+m(r.countryName),1)],void 0,!0),_:1},8,["country-name"])])):n("",!0)])),a.isLoading?(o(),s(h,{key:2,class:"tw-mb-0.5",style:{height:"2rem"}})):n("",!0),a.isLoading?n("",!0):(o(),s(I,{key:3,class:"tw-mb-1 tw-text-h3 tw-mt-1 tw-overflow-hidden tw-text-ellipsis tw-line-clamp-1","max-length":50,name:r.borrowerName,style:{"min-height":"2rem"}},null,8,["name"])),a.isLoading?(o(),s(x,{key:4,class:"tw-mb-1.5 tw-flex-grow",style:{"min-height":"1rem"}})):n("",!0),a.isLoading?n("",!0):(o(),u("div",Y,[l("p",Z,m(r.loanUse),1)])),a.isLoading?(o(),s(h,{key:6,class:"tw-mb-0.5",style:{height:"1.3rem"}})):n("",!0),a.isLoading?(o(),s(h,{key:7,class:"tw-mb-1.5 tw-rounded",style:{height:"0.5rem"}})):n("",!0),a.isLoading?n("",!0):(o(),u("div",$,[l("figure",null,[l("figcaption",ee,[l("div",te,[l("p",ie,m(Math.floor(r.fundraisingPercent))+"% FUNDED ",1)]),l("p",re,[l("span",ae,m(e.$filters.numeral(r.loanAmount,"$0,0[.]00")),1)])]),a.isLoading?n("",!0):(o(),s(L,{key:0,class:"tw-mb-1.5 lg:tw-mb-1 tw-bg-tertiary","aria-label":"Percent the loan has funded",value:r.fundraisingPercent},null,8,["value"]))])]))],void 0),_:1},8,["is","to"])),[[P,["Lending","click-see more","card",i.loanId]]]),r.dedications.length>0?(o(),u("div",oe,[t[1]||(t[1]=g(" ðŸ’š ")),l("button",{class:"data-hj-suppress tw-capitalize tw-text-action hover:tw-underline",onClick:t[0]||(t[0]=(...C)=>r.dedicationClickEvent&&r.dedicationClickEvent(...C))},m(r.dedicationsCopy),1)])):n("",!0)],8,G)}const ke=U(b,[["render",ne],["__scopeId","data-v-c11f0206"]]);b.__docgenInfo={displayName:"NewHomePageLoanCard",exportName:"default",description:"",tags:{},props:[{name:"loanId",type:{name:"number"},required:!0},{name:"lenderPublicId",type:{name:"string"},defaultValue:{func:!1,value:"''"}}],events:[{name:"dedication-click",type:{names:["undefined"]}}],sourceFiles:["/home/runner/work/ui/ui/src/components/LoanCards/NewHomePageLoanCard.vue"]};export{ke as N};
