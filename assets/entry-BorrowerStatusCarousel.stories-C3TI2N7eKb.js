import{r as P,z as N,o as r,C as d,q as i,a as p,c as v,m as E,D as fe,F as Ie,M as F,t as De,j as c,g as f,w as Re,k as $e,V as Pe,E as Oe,u as l,H as Fe,I as O,A as je,b as ze,J,L as Ke}from"./entry-vue.esm-bundler-C0PPCo9W96.js";import{_ as Ue}from"./entry-throttle-DL1zg7kAk0.js";import{u as qe}from"./entry-vue-router-Di6opnONE0.js";import"./entry-KvWwwHeader-C1bm1YMh4q.js";import{g as pe}from"./entry-KvButton-BA7nBLyz1b.js";import{z as He}from"./entry-KvCarousel-Dw4gUt9u7G.js";import"./entry-numeral-xVHG5DEP0A.js";import{_ as We,h as Ze}from"./entry-KvTabs-CbRnT2lqFN.js";import{y as Ge}from"./entry-KvTabPanel-Ct8s7XWvCc.js";import{a as Ye,F as Je,P as Xe,R as Qe,E as et,b as tt,c as ot,B as at}from"./entry-BorrowerStatusCard-BNSGcisqS_.js";import{l as st}from"./entry-logFormatter-DhjghUk5Me.js";import{a as nt}from"./entry-mdi-B1ONwcTkQ2.js";import{_ as rt}from"./entry-loanAddComment-DvQEPf3nxH.js";import{x as lt}from"./entry-KvMaterialIcon-C3KLX5OV-L.js";import{M as it}from"./entry-KvLightbox-y8nxBJS-RZ.js";import{_ as he}from"./entry-_plugin-vue_export-helper-DlAUqK2UKH.js";import{S as ut}from"./entry-ShareButton-Cd2Ioe_1wr.js";import{B as mt}from"./entry-BorrowerImage-CdYtz78wPt.js";import{u as ct}from"./entry-useBreakpoints-D5z-MrjI4Q.js";import{m as dt}from"./entry-utils-LVhxYihmNs.js";import{a as ft}from"./entry-apollo-story-mixin-CB9BNmK9U5.js";import{c as pt}from"./entry-cookie-store-story-mixin-Bv_t57ys9l.js";import"./entry-_commonjsHelpers-Cpj98o6Yn6.js";import"./entry-isSymbol-5pnFTpIKM9.js";import"./entry-toNumber-MeiYJWOH0A.js";import"./entry-index-CWclSTHHJk.js";import"./entry-KvLoadingSpinner-CpYE5b1xV2.js";import"./entry-throttle-4FNEI5INvC.js";import"./entry-HeroBackground-DUNtZ1thHe.js";import"./entry-KvContentfulImg-B0t9ZCrx8O.js";import"./entry-KvSocialShareButton-CuCqxeJm3e.js";import"./entry-social-sharing-mixin-mcFPgMmQne.js";import"./entry-urlUtils-D59-4GikCB.js";import"./entry-stringParserUtils-DNVsfKTBwa.js";import"./entry-imageUtils-XCIqTGZvrk.js";import"./entry-loan-data-mock-B1RgYuoN0n.js";const we={name:"LoanCommentModal",inject:["apollo","cookieStore"],components:{KvLightbox:it,KvMaterialIcon:lt,KvButton:pe},emits:["comment-modal-closed"],props:{loan:{type:Object,default:()=>({})},isVisible:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0}},data(){return{mdiPencilOutline:nt,userComment:"",loading:!1,showError:!1}},computed:{buttonState(){return this.loading?"loading":this.userComment?"":"disabled"},modalTitle(){return`Tell others why you love this loan to ${this.loan.name}`},commentPlaceholder(){return`Tell others why this loan to ${this.loan.name} is great!`}},watch:{isVisible(t){t&&this.$nextTick(()=>{var o;(o=this.$refs.commentTextarea)==null||o.focus()})}},methods:{submitComment(){this.loading=!0,this.showError=!1,this.apollo.mutate({mutation:rt,variables:{id:this.loan.id,body:this.userComment}}).then(({data:t})=>{if(t.loan.addComment)this.closeModal(!0),this.$kvTrackEvent("portfolio","click","Leave a loan comment",this.loan.name,this.loan.id),this.showTip&&this.$showTipMsg(`Thank you for helping ${this.loan.name}!`,"confirmation",!0);else throw new Error("Comment not added")}).catch(t=>{this.showError=!0,st(t,"error")}).finally(()=>{this.loading=!1})},closeModal(t=!1){this.userComment="",this.$emit("comment-modal-closed",t)}}},ht={class:"tw-text-center"},wt={class:"tw-relative"},vt=["placeholder"],bt={key:0,class:"tw-mt-1 tw-text-small tw-text-danger"};function gt(t,o,C,g,m,h){const V=P("kv-material-icon"),A=P("kv-button"),_=P("kv-lightbox");return r(),N(_,{visible:C.isVisible,title:h.modalTitle,onLightboxClosed:o[1]||(o[1]=()=>h.closeModal())},{default:d(()=>[i("div",ht,[i("div",wt,[fe(i("textarea",{ref:"commentTextarea",class:"tw-w-full tw-border tw-border-secondary tw-rounded-xs tw-h-7 tw-p-1 comment-input","onUpdate:modelValue":o[0]||(o[0]=y=>m.userComment=y),placeholder:h.commentPlaceholder},"			",8,vt),[[Ie,m.userComment]]),p(V,{class:"tw-w-2.5 tw-h-2.5 tw-absolute tw-bottom-2 tw-right-0",icon:m.mdiPencilOutline},null,8,["icon"])]),o[2]||(o[2]=i("small",{class:"tw-text-left tw-block"},[F("Please follow our "),i("a",{href:"/kiva-community-guidelines",target:"_blank",class:"tw-text-action hover:tw-text-action-highlight"}," community guidelines ")],-1))]),p(A,{class:"tw-mt-2",variant:"primary","aria-label":"Comment",state:h.buttonState,onClick:h.submitComment},{default:d(()=>o[3]||(o[3]=[F(" Save ")]),void 0,!0),_:1,__:[3]},8,["state","onClick"]),m.showError?(r(),v("p",bt," There was a problem commenting on this loan, try again please. ")):E("",!0)],void 0),_:1},8,["visible","title"])}const _t=he(we,[["render",gt],["__scopeId","data-v-3fc61cc0"]]);we.__docgenInfo={displayName:"LoanCommentModal",exportName:"default",description:"",tags:{},props:[{name:"loan",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"isVisible",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"showTip",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}}],events:[{name:"comment-modal-closed",type:{names:["undefined"]}}],sourceFiles:["/home/runner/work/ui/ui/src/pages/Portfolio/ImpactDashboard/LoanCommentModal.vue"]};const yt=["innerHTML"],kt={key:1,class:"tw-relative"},xt={class:"tw-flex tw-flex-col tw-justify-start tw-items-center tw-w-10"},Ct={class:"tw-w-8 tw-h-8 tw-mx-auto md:tw-mx-0 tw-border-white tw-border-4 tw-rounded-full tw-shadow"},Lt={class:"tw-text-center tw-text-ellipsis tw-line-clamp-2 tw-whitespace-normal tw-pt-0.5"},Mt=["id"],St={class:"carousel-container"},Tt={key:"view-more-card",class:"tw-flex tw-items-center tw-h-full tw-pl-4"},Bt="social_share_portfolio",ve={__name:"BorrowerCarousel",props:{loans:{type:Array,default:()=>[],required:!0},totalLoans:{type:Number,default:0},showMenu:{type:Boolean,default:!1},lender:{type:Object,default:()=>({})},cardsNumber:{type:Number,default:9},showCarouselTabs:{type:Boolean,default:!1},basketItems:{type:Array,default:()=>[]},isAdding:{type:Boolean,default:!1},controlsTopRight:{type:Boolean,default:!1}},emits:["handle-selected-loan","mouse-enter-status-card"],setup(t,{emit:o}){const C=o,g=t,m=ze("$kvTrackEvent"),h=qe(),{isMedium:V,isLarge:A}=ct(),{loans:_,totalLoans:y}=De(g),j=c(null),I=c(!1),k=c(0),z=c(!1),K=c(0),s=c(void 0),D=c(!1),R=c(null),ge=c(0),U=[Ye,Je,Xe,Qe,et,tt,ot],_e=f(()=>_.value.filter(e=>U.includes(e==null?void 0:e.status))),$=f(()=>_e.value.length>0),ye=f(()=>y.value===1?"You’re <u>changing a life</u>!":`You’re <u>changing ${y.value} lives</u>!`),w=f(()=>_.value.filter(e=>U.includes(e==null?void 0:e.status)).slice(0,g.cardsNumber)),ke=f(()=>{var e;return((e=s.value)==null?void 0:e.inPfp)??!1}),xe=f(()=>{var e;return((e=s.value)==null?void 0:e.pfpMinLenders)??0}),Ce=f(()=>{var e,a;return((a=(e=s.value)==null?void 0:e.lenders)==null?void 0:a.numLenders)??0}),Le=f(()=>A.value?"calc((100% - 64px) / 3)":V.value?"336px":"90%"),q=()=>{ge.value=window.innerWidth},H=Ue(q,200),Me=e=>{K.value===k.value&&m("portfolio","click","borrower-card-carousel"),R.value.tabContext.selectedIndex=e.value},Se=e=>{s.value=e==null?void 0:e.loan,s.value&&(I.value=!0)},Te=e=>{s.value=e==null?void 0:e.loan,s.value&&(D.value=!0)},W=()=>{setTimeout(()=>{s.value=void 0},500)},Be=()=>{D.value=!1,W()},Z=e=>{var a;C("handle-selected-loan",{id:(a=e==null?void 0:e.loan)==null?void 0:a.id})},Ne=e=>{I.value=!1,e&&Z({loan:{id:s.value.id}}),W()},G=e=>(e==null?void 0:e.name)??"",Ee=e=>{var a;return((a=e==null?void 0:e.image)==null?void 0:a.hash)??""},Ve=e=>{K.value=k.value,k.value!==e&&m("portfolio","click","borrower-tab-toggle"),e<w.value.length?(j.value.goToSlide(e),k.value=e):R.value.tabContext.selectedIndex=k.value},Ae=()=>{m("portfolio","click","view-all"),h.push("/portfolio/loans")};return Re(()=>_.value,()=>{$.value&&m("portfolio","view","Active borrowers",w.value.length)},{immediate:!0}),$e(()=>{window.addEventListener("resize",H),q()}),Pe(()=>{window.removeEventListener("resize",H)}),(e,a)=>(r(),v("div",null,[$.value?(r(),v("h3",{key:0,innerHTML:ye.value,class:"tw-mt-4 tw-mb-2"},null,8,yt)):E("",!0),$.value?(r(),v("div",kt,[fe(p(l(Ze),{ref_key:"tabs",ref:R,class:"tabs",onTabChanged:Ve},{tabNav:d(()=>[(r(!0),v(J,null,O(w.value,(n,b)=>(r(),N(l(We),{key:b,label:b+1,"for-panel":`${n.id}`},{default:d(()=>[i("div",xt,[i("div",Ct,[p(l(mt),{class:"tw-w-full tw-rounded-full",alt:G(n),"aspect-ratio":1,"default-image":{width:80,faceZoom:50},hash:Ee(n),images:[{width:80,faceZoom:50,viewSize:1024},{width:72,faceZoom:50,viewSize:734},{width:64,faceZoom:50}]},null,8,["alt","hash"])]),i("h5",Lt,Ke(G(n)),1)])],void 0,!0),_:2},1032,["label","for-panel"]))),128))]),tabPanels:d(()=>[(r(!0),v(J,null,O(w.value,(n,b)=>(r(),N(l(Ge),{key:b,id:`${n.id}`},{default:d(()=>[i("p",{class:"tw-hidden",id:n.id},null,8,Mt)],void 0,!0),_:2},1032,["id"]))),128))]),_:1},512),[[Oe,w.value.length>1&&t.showCarouselTabs]]),i("div",St,[p(l(He),{ref_key:"carousel",ref:j,class:je(["borrower-carousel tw-w-full",{"tw--mt-6":t.controlsTopRight}]),"multiple-slides-visible":!0,"slide-max-width":Le.value,"embla-options":{loop:!1,align:"start"},"controls-top-right":t.controlsTopRight,onChange:Me},Fe({_:2},[O(w.value,(n,b)=>({name:`slide${b+1}`,fn:d(()=>[p(l(at),{class:"tw-h-full !tw-w-full",loan:n,"open-what-is-next":z.value,"show-menu":t.showMenu,onToggleWhatIsNext:a[0]||(a[0]=Y=>z.value=Y),onOpenCommentModal:Se,onOpenShareModal:Te,onOpenSideSheet:Z,onMouseenter:Y=>e.$emit("mouse-enter-status-card",n==null?void 0:n.id)},null,8,["loan","open-what-is-next","show-menu","onMouseenter"])])})),l(y)>w.value.length?{name:"see-all",fn:d(()=>[(r(),v("div",Tt,[p(l(pe),{class:"tw-mt-2 tw-whitespace-nowrap",variant:"secondary",onClick:Ae},{default:d(()=>a[1]||(a[1]=[F(" See all ")]),void 0,!0),_:1,__:[1]})]))]),key:"0"}:void 0]),1032,["class","slide-max-width","controls-top-right"])])])):E("",!0),p(l(_t),{loan:s.value,"is-visible":I.value,"show-tip":!1,onCommentModalClosed:Ne},null,8,["loan","is-visible"]),s.value?(r(),N(l(ut),{key:2,class:"tw-block !tw-w-auto",variant:"hidden",loan:s.value,lender:t.lender,campaign:Bt,"in-pfp":ke.value,"pfp-min-lenders":xe.value,"num-lenders":Ce.value,"open-lightbox":D.value,"is-portfolio":!0,onLightboxClosed:Be},null,8,["loan","lender","in-pfp","pfp-min-lenders","num-lenders","open-lightbox"])):E("",!0)]))}},be=he(ve,[["__scopeId","data-v-4a0c5e71"]]);ve.__docgenInfo={exportName:"default",displayName:"BorrowerCarousel",description:"",tags:{},props:[{name:"loans",description:"Array of loans",type:{name:"array"},required:!0,defaultValue:{func:!1,value:"[]"}},{name:"totalLoans",type:{name:"number"},defaultValue:{func:!1,value:"0"}},{name:"showMenu",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"lender",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"cardsNumber",type:{name:"number"},defaultValue:{func:!1,value:"9"}},{name:"showCarouselTabs",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"basketItems",type:{name:"array"},defaultValue:{func:!1,value:"[]"}},{name:"isAdding",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"controlsTopRight",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"mouse-enter-status-card"},{name:"handle-selected-loan"}],sourceFiles:["/home/runner/work/ui/ui/src/components/MyKiva/BorrowerCarousel.vue"]};const po={title:"MyKiva/BorrowerCarousel",component:be},u=dt(3),Nt={data:{lend:{loan:u[0]}}},x=(t={})=>{const o=(C,{argTypes:g})=>({props:Object.keys(g),components:{BorrowerCarousel:be},mixins:[ft({queryResult:Nt}),pt()],setup(){return{args:t}},template:`
            <borrower-carousel v-bind="args" />
        `});return o.args=t,o},L=x({loans:[u[0],u[1],u[2]]}),M=x({loans:[u[0]]}),S=x({loans:[...u,u[0]]}),T=x({loans:[u[0],u[1],u[2]],hasActiveLoans:!1}),B=x({loans:[]});var X,Q,ee;L.parameters={...L.parameters,docs:{...(X=L.parameters)==null?void 0:X.docs,source:{originalSource:`story({
  loans: [mockLoans[0], mockLoans[1], mockLoans[2]]
})`,...(ee=(Q=L.parameters)==null?void 0:Q.docs)==null?void 0:ee.source}}};var te,oe,ae;M.parameters={...M.parameters,docs:{...(te=M.parameters)==null?void 0:te.docs,source:{originalSource:`story({
  loans: [mockLoans[0]]
})`,...(ae=(oe=M.parameters)==null?void 0:oe.docs)==null?void 0:ae.source}}};var se,ne,re;S.parameters={...S.parameters,docs:{...(se=S.parameters)==null?void 0:se.docs,source:{originalSource:`story({
  loans: [...mockLoans, mockLoans[0]]
})`,...(re=(ne=S.parameters)==null?void 0:ne.docs)==null?void 0:re.source}}};var le,ie,ue;T.parameters={...T.parameters,docs:{...(le=T.parameters)==null?void 0:le.docs,source:{originalSource:`story({
  loans: [mockLoans[0], mockLoans[1], mockLoans[2]],
  hasActiveLoans: false
})`,...(ue=(ie=T.parameters)==null?void 0:ie.docs)==null?void 0:ue.source}}};var me,ce,de;B.parameters={...B.parameters,docs:{...(me=B.parameters)==null?void 0:me.docs,source:{originalSource:`story({
  loans: []
})`,...(de=(ce=B.parameters)==null?void 0:ce.docs)==null?void 0:de.source}}};const ho=["Default","OneLoan","MoreThanLimit","NoActiveLoans","Empty"];export{L as Default,B as Empty,S as MoreThanLimit,T as NoActiveLoans,M as OneLoan,ho as __namedExportsOrder,po as default};
